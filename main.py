from flask import Flask, request, abort,render_template
import livejson,json,random
from youtubesearchpython import Search
import tempfile
import ffmpeg
import os
import glob
import speech_recognition as sr
from utils import get_user_profile,get_profile
from os.path import splitext
from linebot.v3 import (
    WebhookHandler
)
from linebot.v3.models import (
    UnknownEvent
)
from linebot.v3.exceptions import (
    InvalidSignatureError
)
from linebot.v3.webhooks import (
    MessageEvent,
    TextMessageContent,
    LocationMessageContent,
    StickerMessageContent,
    ImageMessageContent,
    VideoMessageContent,
    AudioMessageContent,
    FileMessageContent,
    UserSource,
    RoomSource,
    GroupSource,
    FollowEvent,
    UnfollowEvent,
    JoinEvent,
    LeaveEvent,
    PostbackEvent,
    BeaconEvent,
    MemberJoinedEvent,
    MemberLeftEvent,
    UnsendEvent
)
from linebot.v3.messaging import (
    Configuration,
    ApiClient,
    MessagingApi,
    MessagingApiBlob,
    ReplyMessageRequest,
    PushMessageRequest,
    MulticastRequest,
    BroadcastRequest,
    TextMessage,
    ApiException,
    LocationMessage,
    StickerMessage,
    ImageMessage,
    TemplateMessage,
    FlexMessage,
    Emoji,
    QuickReply,
    QuickReplyItem,
    ConfirmTemplate,
    ButtonsTemplate,
    CarouselTemplate,
    CarouselColumn,
    ImageCarouselTemplate,
    ImageCarouselColumn,
    FlexBubble,
    FlexImage,
    FlexBox,
    FlexText,
    FlexIcon,
    FlexButton,
    FlexSeparator,
    FlexContainer,
    MessageAction,
    URIAction,
    PostbackAction,
    DatetimePickerAction,
    CameraAction,
    CameraRollAction,
    LocationAction,
    ErrorResponse
)

from linebot.v3.insight import (
    ApiClient as InsightClient,
    Insight
)
from linebot.models.unsend import Unsend
import qrcode
from PIL import Image
import bs4
import requests

import re
from ngcheck import NgWordSystem
NgWordSystem = NgWordSystem()

def remove_inappropriate_words(text):
    inappropriate_words_h = [
        "ã‚ã„ã¬ã‘ã„", "ã‚ã„ã®ã“", "ã‚ãŠã‹ã‚“", "ã‚ã‹", "ã‚ãã‚ãã‚‰", "ã‚ã—ãã‚Š", "ã‚ã—ã‚’ã‚ã‚‰ã†", "ã‚ã¦ã†ã¾", "ã‚ã‚ã“ã†", "ã‚ã‚‰ã‚ã‚“", 
        "ã‚ã‚‹ã¡ã‚…ã†", "ã‚ã‚“ã¾", "ã„ãˆãŒã‚‰", "ã„ã‹ã•ã¾", "ã„ã–ã‚Š", "ã„ã›ã“ã˜ã", "ã„ãŸã“ã†", "ã„ãŸã¾ãˆ", "ã„ã¡ã‚ƒã‚‚ã‚“", "ã„ãªã‹", 
        "ã„ã¬ã”ã‚ã—", "ã„ã¿ã‚“", "ã„ã‚‚", "ã„ã‚“ã¡ã", "ã„ã‚“ã§ãƒã‚ã‚“ã†ãã¤ã‹ãªã„", "ã„ã‚“ã°ã„", "ã†ã‚‰ã«ã»ã‚“", "ã†ã‚“ã“", "ã†ã‚“ã¡ã‚ƒã‚“", 
        "ãˆã™ãã‚‚ãƒ¼", "ãˆãŸ", "ãˆã¡ã”ã®ã“ã‚ã¤ã", "ãˆã¡ãœã‚“ãã‚‰ã’", "ãˆã§ãƒãŸãƒ¼", "ãŠãƒ¼ãˆã‚‹", "ãŠãƒ¼ã‚‹ã©ã¿ã™", "ãŠã‹ã¾", 
        "ãŠããªã‹ã—", "ãŠã—", "ãŠã¡ã†ã©ã¶ã‚‰ã", "ãŠã¡ã“ã¼ã‚Œ", "ãŠã¨ã—ã¾ãˆ", "ãŠã¼ã‚Œã˜ã¬", "ãŠã¾ã‚ã‚Š", "ãŠã‚‚ã¦ã«ã»ã‚“", "ãŠã‚„ã‹ãŸ", "ãŠã‚ã„ã‚„", 
        "ãŠã‚“ãªã“ã©ã‚‚", "ãŠã‚“ãªã®ãã•ã£ãŸã‚ˆã†ãª", "ãŠã‚“ã¼ã†", "ãŒã„ã˜ã‚“", "ã‹ãˆã‚‹ã®ã“ã¯ã‹ãˆã‚‹", "ãŒã", "ã‹ãã—ã‚“ã¯ã‚“", "ã‹ãã¡ã‚‡ã†ã„ã‚“", "ã‹ãã¡ã‚‡ã†ã ã‚“", 
        "ã‹ãã¡ã‚‡ã†ã ã‚“ã¡ã‚‡ã†", "ã‹ã‘ã„", "ã‹ã“ã¡ã‚‡ã†", "ãŒã•", "ã‹ã•ã£ã‹ã", "ã‹ãŸã‚ã—", "ã‹ãŸãŠã‚„", "ã‹ãŸã¦ãŠã¡", "ã‹ãŸã¯ã„", "ã‹ãŸã‚", 
        "ã‹ãŸã‚", "ãŒã¡ã‚ƒã‚", "ã‹ã¤ãã‚„", "ã‹ã£ãŸã„", "ãŒã£ã·ã‚Šã‚ˆã¤", "ã‹ã£ãº", "ã‹ã¿ãŒãŸã®ãœã„ã‚ã", "ã‹ã‚Šã°ã‚‰", "ã‹ã‚ã‹ã¶ã‚Š", 
        "ã‹ã‚ãã‚Š", "ã‹ã‚ã‚€ã“ã†", "ã‹ã‚ã‚‰ã“ã˜ã", "ã‹ã‚“ã”ãµ", "ã‹ã‚“ã¤ã†", "ãã˜ã‚‹ã—", "ãã¡", "ãã¡ãŒã„", "ãã¡ãŒã„ã–ãŸ", "ãã¡ãŒã„ã«ã¯ã‚‚ã®", 
        "ãã£ã¡ã‚‡", "ãã‚…ã†ã˜", "ãã‚…ã†ã‚’ã™ãˆã‚‹", "ãã‚‡ã†ã", "ãã‚‡ã†ãã®ã•ãŸ", "ãã‚‡ã†ã˜ã‚‡", "ãã‚‡ã†ã˜ã‚“", "ãã‚‡ãµ", "ããƒ¼ã‚Šãƒ¼", "ããšã‚„", 
        "ãã©ã‚“", "ãã³ãã‚Š", "ãã¿ã¨ã‚Šã‚„", "ãã‚‹ã†", "ãã‚", "ãã‚ã‚“ã¼", "ãã‚ãˆã“ã‚€", "ãã‚“ã«", "ãã‚“ã‚‚ã†ãã†ã‚’ãªã§ã‚‹", "ã’ã„ã«ã‚“", 
        "ã’ãƒ¼ã›ã‚“", "ã’ã˜ã‚‡", "ã‘ã£ã¨ã†", "ã‘ã¨ã†", "ã’ãªã‚“", "ã‘ã‚“ãœã‚“ãªã‚‹ã›ã„ã—ã‚“ã¯ã‘ã‚“ãœã‚“ãªã‚‹ã—ã‚“ãŸã„ã«ã‚„ã©ã‚‹", "ã’ã‚“ãªã¾", "ã”ã†ã‹ã‚“", "ã“ã†ã—ã‚“ã“ã", "ã“ã†ã—ã‚“ã˜ã‚‡", 
        "ã”ã†ã³ã‚‡ã†", "ã“ã†ãµ", "ã“ã†ãµ", "ã“ã†ãµ", "ã“ã†ã‚‚ã†ã˜ã‚“", "ã“ãã˜ã‚“", "ã“ã‘", "ã“ã˜ã„ã‚“", "ã“ã˜ã", "ã“ãã†", 
        "ã“ã¥ã‹ã„", "ã“ã©ã‚‚", "ã“ã³ã¨", "ã”ã¿ã‚„", "ã“ã‚ã—", "ã•ã‹ãªã‚„", "ã–ãã‚“", "ã•ã¤", "ã•ã‚‰ãã‚“", "ã•ã‚‰ã¶ã‚Œã£ã©", 
        "ã•ã‚“ã‹ã‚“ã›ã„ã°ã¤", "ã•ã‚“ã”ãã˜ã‚“", "ã•ã‚“ã™ã‘", "ã•ã‚“ã°", "ã—ãã‚‚ã†", "ã—ãª", "ã—ãªã˜ã‚“", "ã—ãªãã°", "ã—ãªã¡ã", "ã—ãªã‚Šã‚‡ã†ã‚Š", 
        "ã—ã®ã†ã“ã†ã—ã‚‡ã†", "ã˜ã·ã—ãƒ¼", "ã˜ã¸ã„ã—ã‚‡ã†ã˜", "ã—ã¾", "ã˜ã¾ã‚ã‚Š", "ã˜ã‚ƒã£ã·", "ã˜ã‚ƒã‚Š", "ã˜ã‚…ãƒ¼", "ã˜ã‚…ã†ã„", "ã—ã‚…ã†ã›ã‚“ã‚„", 
        "ã—ã‚…ã†ã¡ã‚‡ã†", "ã˜ã‚‡ã†", "ã—ã‚‡ã†ãŒã„ã—ã‚ƒ", "ã—ã‚‡ã†ãã ãŠã—ã«ãªã‚‹", "ã˜ã‚‡ã†ãµ", "ã˜ã‚‡ã†ãµ", "ã˜ã‚‡ãã‚…ã†", "ã—ã‚‡ãã¶ã¤ã«ã‚“ã’ã‚“", "ã˜ã‚‡ã‘ã¤", "ã˜ã‚‡ã“ã†", 
        "ã˜ã‚‡ã•ã‚“ã·", "ã—ã‚‡ã˜ã‚‡ã•ã", "ã—ã‚‡ã˜ã‚‡ã»ã†", "ã˜ã‚‡ã¡ã‚…ã†", "ã—ã‚‡ã£ã“ã†", "ã—ã‚‰ã£ã“", "ã—ã‚Šã¬ãã„", "ã—ã‚“ã—ã‚‡ã†ã˜", "ã—ã‚“ã—ã‚‡ã†ã—ã‚ƒ", "ã—ã‚“ã¸ã„ã¿ã‚“", 
        "ãšãƒ¼ã˜ã‚ƒãƒ¼", "ã™ã‘", "ã™ã‘ã“ã¾ã—", "ã™ã¡ã‚…ã‚ãƒ¼ã§ã™", "ã™ã¹ã‚Šã©ã‚", "ãšã‚‰ã‹ã‚‹", "ã™ã‚‰ã‚€", "ã›ã„ã•ã„", "ã›ã„ã—ã‚“ã„ã˜ã‚‡ã†", "ã›ã„ã—ã‚“ã¶ã‚“ã‚Œã¤ã³ã‚‡ã†", 
        "ã›ã„ã¯ã", "ã›ã‚€ã—", "ã›ã‚“ã˜ã‚“", "ã›ã‚“ã™ã„ãµ", "ã›ã‚“ãšã‚Š", "ã›ã‚“ã‚ã“ã†ãµ", "ãã†ã˜ãµ", "ãã†ã˜ãµ", "ãã†ã‚„ããµ", "ãã ã¡ã‚ˆã‚Šã†ã˜", 
        "ã ã„ã•ã‚“ã”ã", "ã ã„ã—ã‚‡ã‚„", "ãŸã„ã‚ã‚“ã›ã„ãµ", "ãŸã„ã‚ã‚“ã¯ã’", "ãŸã‘ã®ã“ã„ã—ã‚ƒ", "ãŸã“ã¹ã‚„", "ãŸãŸã", "ã ã£ã¡ã¾ã‚“", "ãŸã¾ã¶ãã‚ã™ã˜ãŸã‚ã†", "ãŸã‚Šãã»ã‚“ãŒã‚“", 
        "ãŸã‚ŒãªãŒã™", "ã¡ãˆãŠãã‚Œ", "ã¡ã‹ã‚", "ã¡ã™ã˜", "ã¡ã³", "ã¡ã»ã†ã—ã‚‡ã†", "ã¡ã‚ƒã‚Šã‚“ã“", "ã¡ã‚ƒã‚“ã“ã‚", "ã¡ã‚…ã†ãã‚‡ã†", "ã¡ã‚‡ã†ã›ã‚“ã›ã„ã°ã¤", 
        "ã¡ã‚‡ã†ã›ã‚“ã«ã‚“ã˜ã‚“", "ã¡ã‚‡ã‚“", "ã¡ã‚“ã°", "ã¤ã‚ŠãŒã", "ã¤ã‚Œã”", "ã¤ã‚“ã¼", "ã¤ã‚“ã¼ã•ã˜ã", "ã¦ã„ã‹ã„ã¯ã¤ã“ã", "ã¦ã„ã®ã†", "ã¦ã„ã®ã†ã˜", 
        "ã§ã‹", "ã§ã‹ã›ã", "ã§ã£ã¡", "ã§ã‚‚ã©ã‚Š", "ã¦ã‚“ã•ã„ã¨ãã‚‡ã†ã˜ã‚“ã¯ã‹ã¿ã²ã¨ãˆ", "ã¦ã‚“ã¼ã†", "ã©ã‹ãŸ", "ã¨ãã—ã‚…ãŒã£ãã‚…ã†", "ã¨ãã—ã‚…ãŒã£ã“ã†", "ã¨ãã—ã‚…ã¶ã‚‰ã", 
        "ã©ã‘ã‚“ã‚„", "ã©ã“ã†", "ã¨ã“ã‚„", "ã©ã–ãˆã‚‚ã‚“", "ã¨ã•ã¤", "ã¨ã•ã¤ã˜ã‚‡ã†", "ã¨ã•ã¤ã«ã‚“", "ã©ã•ã¾ã‚ã‚Š", "ã©ã˜ã‚“", "ã¨ã‚‚ã‹ã›ã", 
        "ã©ã‚‚ã‚Š", "ã©ã‚„", "ã©ã‚„ãŒã„", "ã¨ã‚„ã¾ã®ã•ã‚“ã™ã‘", "ã¨ã‚‹ã“ã˜ã‚‡ã†", "ã¨ã‚‹ã“ã¶ã‚", "ã©ã‚“ã³ã‚ƒãã—ã‚‡ã†", "ãªãŠã‚“", "ãªã‚“ã›ã‚“", "ãªã‚“ã¶ã®ã—ã‚ƒã‘ã®ã¯ãªã¾ãŒã‚Š", 
        "ã«ãŒãƒ¼", "ã«ãã‚", "ã«ã”ã†", "ã«ã“ã‚ˆã‚“", "ã«ã»ã‚“ã®ã¡ã¹ã£ã¨", "ã«ã‚“ãã", "ã«ã‚“ã´ã«ã‚“", "ã«ã‚“ã·", "ã­ã“ã°ã°", "ã®ã†ãµ", 
        "ã®ã†ã¾ããˆã‚“", "ã®ã³", "ã¯ãƒ¼ãµ", "ã±ãƒ¼ã¾ã‚„", "ã°ã‹ã¡ã‚‡ã‚“ã‹ã‚ã‚‰", "ã°ã‹ã§ã‚‚ã¡ã‚‡ã‚“ã§ã‚‚", "ã¯ãã¡", "ã±ãã‚‹", "ã°ãã‚ã†", "ã¯ã—ãŸã‚", 
        "ã¯ã ã„ã‚", "ã°ãŸã‚„", "ã¯ã£ãã‚‡ã†ã™ã‚‹", "ã°ã¦ã„", "ã±ã‚“ã™ã‘", "ã°ã‚“ãŸ", "ã¯ã‚“ã¨ã†ã˜ã‚“", "ã¯ã‚“ã°", "ã²ã‹ã‚Œã‚‚ã®", "ã³ã£ã“", 
        "ã²ã«ã‚“", "ã²ã‚‚", "ã²ã‚ƒãã—ã‚‡ã†", "ã²ã‚„ã¨ã„", "ã²ã‚“ã®ã†", "ã¶ãŠã¨ã“", "ãµã‹ã—ã‚‡ãã¿ã‚“", "ãµã", "ãµã‘ã„", "ãµã˜ã®ã‚„ã¾ã„", 
        "ã¶ã™", "ã¶ãŸã°ã“", "ã¶ã¤", "ãµã¿ãã‚Šã°ã‚“", "ã¶ã‚‰ã„ã‚“ã©ãŸã£ã¡", "ã¶ã‚‰ã", "ãµã‚ã†ã˜", "ãµã‚ã†ã—ã‚ƒ", "ãºã„ã‹ã‚“", "ãºã„ã¡ã‚…ã†", 
        "ã¼ã†ãš", "ã»ãã›ã‚“", "ã½ã“ãºã‚“", "ã»ã›ã‚“ã“ã†ãµ", "ã½ã£ã½ãƒ¼ã‚„", "ã»ã¼", "ã½ã‚Šã“ã†", "ã»ã‚“ã”ã—ã‚’ã„ã‚Œã‚‹", "ã½ã‚“ã³ã", "ã»ã‚“ã¼ã—", 
        "ã¾ãˆã¤ã", "ã¾ã˜ã‚‡ã£ã“", "ã¾ãŸã«ã‹ã‘ã‚‹", "ã¾ã¡ã„ã—ã‚ƒ", "ã¾ã‚“ã“", "ã¾ã‚“ã—ã‚…ã†", "ã¿ã‹ã„ã˜ã‚“", "ã¿ã‹ã„ã¯ã¤ã“ã", "ã¿ã¤ãã¡", "ã¿ã¶ã‚“", 
        "ã¿ã¼ã†ã˜ã‚“", "ã¿ã‚‚ã¨ã¡ã‚‡ã†ã•", "ã‚€ã“ã‚’ã¨ã‚‹", "ã‚€ã™ã‚ã‚’ã‹ãŸã¥ã‘ã‚‹", "ã‚ã„ã‚‚ã‚“ã“ã†", "ã‚ã‹ã‘", "ã‚ãã‚‰", "ã‚ãã‚‰ã˜ã¾", "ã‚ãã‚‰ã°ã‚“ã‚’ãŠã™", "ã‚ãã‚‰ã¸ã³ã«ãŠã˜ãš", 
        "ã‚ãã‚‰ã‚ã£ã½ã†", "ã‚ã£ã‹ã¡", "ã‚‚ã†ã‚ã„ã™ã‚‹", "ã‚‚ã†ã“ã—ã‚‡ã†", "ã‚‚ã†ã˜ã‚“", "ã‚‚ã†ã‚‚ã", "ã‚‚ã‚“ã‚‚ã†", "ã‚„ãƒ¼ã•ã¾", "ã‚„ãŠã‚„", "ã‚„ãã¶ãã", 
        "ã‚„ã•ãã‚Œ", "ã‚„ã°ã„", "ã‚„ã¶ã„ã—ã‚ƒ", "ã‚„ã¶ã«ã‚‰ã¿", "ã‚„ã‚“ããƒ¼", "ã‚„ã‚“ãã„", "ã‚†ã†ã³ã‚“ãµ", "ã‚†ã†ã³ã‚“ã‚„", "ã‚ˆã†ã”", "ã‚ˆã†ã‚ã†ã„ã‚“", 
        "ã‚ˆã›ã°", "ã‚ˆã¤", "ã‚ˆã¤ã‚ã—", "ã‚ˆã¤ã¤ã˜", "ã‚ˆã‚ã«ã‚„ã‚‹", "ã‚ˆã‚Šã‚", "ã‚‰ã„ã³ã‚‡ã†", "ã‚‹ã‚“ãºã‚“", "ã‚Œã„ã˜ã‚‡ã†", "ã‚Œã‚“ã¨ã’ã‚“ãã—", 
        "ã‚ã†ã°", "ã‚ã†ã‚€ã—ã‚ƒ", "ã‚ã™ã‘", "ã‚ã‚“ã±ã‚Š"
    ]
    inappropriate_words_k = [
        "ã‚¢ã‚¤ãƒŒç³»", "åˆã„ã®å­", "é’å§¦", "ã‚¢ã‚«", "æ˜ç›²", "è¶³åˆ‡ã‚Š", "è¶³ã‚’æ´—ã†", "å½“ã¦é¦¬", "ã‚¢ãƒ¡å…¬", "ã‚ã‚‰ã‚ã‚“", 
        "ã‚¢ãƒ«ä¸­", "æŒ‰æ‘©", "å®¶æŸ„", "ã‚¤ã‚«ã‚µãƒ", "èº„", "ä¼Šå‹¢ä¹é£Ÿ", "ã‚¤ã‚¿å…¬", "æ¿å‰", "ã„ã¡ã‚ƒã‚‚ã‚“", "ç”°èˆ", 
        "çŠ¬æ®ºã—", "ç§»æ°‘", "ã‚¤ãƒ¢", "ã‚¤ãƒ³ãƒã‚­", "ã‚¤ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³å˜˜ã¤ã‹ãªã„", "æ·«å£²", "è£æ—¥æœ¬", "ã†ã‚“ã“", "é‹ã¡ã‚ƒã‚“", 
        "ã‚¨ã‚¹ã‚­ãƒ¢ãƒ¼", "ç©¢å¤š", "è¶Šå¾Œã®ç±³ã¤ã", "ã‚¨ãƒã‚¼ãƒ³ã‚¯ãƒ©ã‚²", "ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼", "ï¼¯ï¼¬", "ã‚ªãƒ¼ãƒ«ãƒ‰ãƒŸã‚¹", "ã‚ªã‚«ãƒ", 
        "æ²–ä»²ä»•", "å”–", "è½äººéƒ¨è½", "è½ã¡ã“ã¼ã‚Œ", "è½ã¨ã—å‰", "æººã‚Œæ­»ã¬", "ãŠå·¡ã‚Š", "è¡¨æ—¥æœ¬", "è¦ªæ–¹", "ãŠã‚ã„ã‚„", 
        "å¥³å­ä¾›", "å¥³ã®è…ã£ãŸã‚ˆã†ãª", "éš åŠ", "å¤–äºº", "è›™ã®å­ã¯è›™", "ã‚¬ã‚­", "ç¢ºä¿¡çŠ¯", "æ‹¡å¼µå“¡", "æ‹¡å¼µå›£", 
        "æ‹¡å¼µå›£é•·", "å®¶ç³»", "éå»å¸³", "ã‚¬ã‚µ", "ã‹ã•ã£ã‹ã", "ç‰‡è¶³", "ç‰‡è¦ª", "ç‰‡æ‰‹è½ã¡", "ç‰‡è‚º", "ç‰‡ç›®", 
        "ç‰‡ç«¯", "ãŒã¡ã‚ƒç›®", "æ‹…ãå±‹", "ã‹ã£ãŸã„", "ãŒã£ã·ã‚Šå››ã¤", "ã‚«ãƒƒãƒš", "ä¸Šæ–¹ã®è´…å…­", "å€Ÿã‚Šè…¹", "çš®è¢«ã‚Š", 
        "çš®åˆ‡ã‚Š", "å·å‘ã“ã†", "æ²³åŸä¹é£Ÿ", "çœ‹è­·å©¦", "å§¦é€š", "ã‚­å°", "ã‚­ãƒ", "æ°—é•ã„", "æ°—é•ã„æ²™æ±°", "æ°—é•ã„ã«åˆƒç‰©", 
        "ãã£ã¡ã‚‡", "çµ¦ä»•", "ç¸ã‚’æ®ãˆã‚‹", "ç‹‚æ°—", "ç‹‚æ°—ã®æ²™æ±°", "ç‹‚å¥³", "ç‹‚äºº", "æ¼å¤«", "è‹¦åŠ›", "å±‘å±‹", 
        "æ„šéˆ", "é¦–åˆ‡ã‚Š", "æ±²ã¿å–ã‚Šå±‹", "ç‹‚ã†", "ã‚¯ãƒ­", "é»’ã‚“ã¼", "ãã‚ãˆè¾¼ã‚€", "ã‚¯ãƒ³ãƒ‹", "ç¾¤ç›²è±¡ã‚’ãªã§ã‚‹", "èŠ¸äºº", 
        "ã‚²ãƒ¼ã‚»ãƒ³", "ä¸‹å¥³", "è¡€çµ±", "æ¯›å”", "ä¸‹ç”·", "å¥å…¨ãªã‚‹ç²¾ç¥ã¯å¥å…¨ãªã‚‹èº«ä½“ã«å®¿ã‚‹", "ã‚²ãƒ³ãƒŠãƒ", "å¼·å§¦", "å¾Œé€²å›½", "èˆˆä¿¡æ‰€", 
        "æ¥­ç—…", "é‰±å¤«", "å·¥å¤«", "å‘å¤«", "ç´…æ¯›äºº", "é»’äºº", "è™šä»®", "å­¤å…é™¢", "ä¹é£Ÿ", "å°åƒ§", 
        "å°ä½¿ã„", "å­ä¾›", "å°äºº", "ã‚´ãƒŸå±‹", "ã‚³ãƒ­ã‚·", "é­šå±‹", "ã‚¶ã‚®ãƒ³", "ã‚µãƒ„", "ã‚µãƒ©é‡‘", "ã‚µãƒ©ãƒ–ãƒ¬ãƒƒãƒ‰", 
        "ä¸‰éŸ“å¾ä¼", "ä¸‰å›½äºº", "ä¸‰åŠ©", "ç”£å©†", "è‰²ç›²", "æ”¯é‚£", "æ”¯é‚£äºº", "æ”¯é‚£è•éº¦", "æ”¯é‚£ç«¹", "æ”¯é‚£æ–™ç†", 
        "å£«è¾²å·¥å•†", "ã‚¸ãƒ—ã‚·ãƒ¼", "è‡ªé–‰ç—‡å…", "ã‚·ãƒ", "åœ°å›ã‚Š", "ã‚¸ãƒ£ãƒƒãƒ—", "ã‚¸ãƒ£ãƒª", "ã‚¸ãƒ¥ãƒ¼", "ç£åŒ»", "å‘¨æ—‹å±‹", 
        "é…‹é•·", "å¬¢", "éšœå®³è€…", "å°†æ£‹å€’ã—ã«ãªã‚‹", "æƒ…å¤«", "æƒ…å©¦", "å¥³çµ¦", "æ¤ç‰©äººé–“", "å¥³å‚‘", "å¥³å·¥", 
        "åŠ©ç”£å©¦", "å‡¦å¥³ä½œ", "å‡¦å¥³å³°", "å¥³ä¸­", "è·å·¥", "ã—ã‚‰ã£ã“", "å°»æ‹­ã„", "å¿ƒéšœå…", "å¿ƒéšœè€…", "æ–°å¹³æ°‘", 
        "ã‚ºãƒ¼ã‚¸ãƒ£ãƒ¼", "ã‚¹ã‚±", "ã™ã‘ã“ã¾ã—", "ã‚¹ãƒãƒ¥ãƒ¯ãƒ¼ãƒ‡ã‚¹", "æ»‘ã‚Šæ­¢ã‚", "ãšã‚‰ã‹ã‚‹", "ã‚¹ãƒ©ãƒ ", "æ­£å¦»", "ç²¾ç¥ç•°å¸¸", "ç²¾ç¥åˆ†è£‚ç—…", 
        "ç²¾è–„", "å‚´åƒ‚", "é®®äºº", "æ½œæ°´å¤«", "åƒæ‘ºã‚Š", "ç·šè·¯å·¥å¤«", "æƒé™¤å©¦", "æƒé™¤å¤«", "é›‘å½¹å¤«", "è‚²ã¡ã‚ˆã‚Šæ°",
    ]
    #sex = read_lines_from_txt("./dicts/Sexual.txt")
    #sexbopo = read_lines_from_txt("./dicts/Sexual_bopo.txt")
    #sexmask = read_lines_from_txt("./dicts/Sexual_mask.txt")
    #bopo = read_lines_from_txt("./dicts/bopo.txt")
    #Offense = read_lines_from_txt("./dicts/Offense.txt")
    #combined_list = inappropriate_words_h + inappropriate_words_k + sex + sexbopo + sexmask + bopo + Offense
    combined_list = inappropriate_words_h + inappropriate_words_k
    pattern = re.compile("|".join(map(re.escape, combined_list)))
    return pattern.sub("*", text)

def contains_inappropriate_words(text, inappropriate_words):
    pattern = re.compile("|".join(map(re.escape, inappropriate_words)))
    return bool(pattern.search(text))


def checknsfw(words):
    inappropriate_words_h = [
        "ã‚ã„ã¬ã‘ã„", "ã‚ã„ã®ã“", "ã‚ãŠã‹ã‚“", "ã‚ã‹", "ã‚ãã‚ãã‚‰", "ã‚ã—ãã‚Š", "ã‚ã—ã‚’ã‚ã‚‰ã†", "ã‚ã¦ã†ã¾", "ã‚ã‚ã“ã†", "ã‚ã‚‰ã‚ã‚“", 
        "ã‚ã‚‹ã¡ã‚…ã†", "ã‚ã‚“ã¾", "ã„ãˆãŒã‚‰", "ã„ã‹ã•ã¾", "ã„ã–ã‚Š", "ã„ã›ã“ã˜ã", "ã„ãŸã“ã†", "ã„ãŸã¾ãˆ", "ã„ã¡ã‚ƒã‚‚ã‚“", "ã„ãªã‹", 
        "ã„ã¬ã”ã‚ã—", "ã„ã¿ã‚“", "ã„ã‚‚", "ã„ã‚“ã¡ã", "ã„ã‚“ã§ãƒã‚ã‚“ã†ãã¤ã‹ãªã„", "ã„ã‚“ã°ã„", "ã†ã‚‰ã«ã»ã‚“", "ã†ã‚“ã“", "ã†ã‚“ã¡ã‚ƒã‚“", 
        "ãˆã™ãã‚‚ãƒ¼", "ãˆãŸ", "ãˆã¡ã”ã®ã“ã‚ã¤ã", "ãˆã¡ãœã‚“ãã‚‰ã’", "ãˆã§ãƒãŸãƒ¼", "ãŠãƒ¼ãˆã‚‹", "ãŠãƒ¼ã‚‹ã©ã¿ã™", "ãŠã‹ã¾", 
        "ãŠããªã‹ã—", "ãŠã—", "ãŠã¡ã†ã©ã¶ã‚‰ã", "ãŠã¡ã“ã¼ã‚Œ", "ãŠã¨ã—ã¾ãˆ", "ãŠã¼ã‚Œã˜ã¬", "ãŠã¾ã‚ã‚Š", "ãŠã‚‚ã¦ã«ã»ã‚“", "ãŠã‚„ã‹ãŸ", "ãŠã‚ã„ã‚„", 
        "ãŠã‚“ãªã“ã©ã‚‚", "ãŠã‚“ãªã®ãã•ã£ãŸã‚ˆã†ãª", "ãŠã‚“ã¼ã†", "ãŒã„ã˜ã‚“", "ã‹ãˆã‚‹ã®ã“ã¯ã‹ãˆã‚‹", "ãŒã", "ã‹ãã—ã‚“ã¯ã‚“", "ã‹ãã¡ã‚‡ã†ã„ã‚“", "ã‹ãã¡ã‚‡ã†ã ã‚“", 
        "ã‹ãã¡ã‚‡ã†ã ã‚“ã¡ã‚‡ã†", "ã‹ã‘ã„", "ã‹ã“ã¡ã‚‡ã†", "ãŒã•", "ã‹ã•ã£ã‹ã", "ã‹ãŸã‚ã—", "ã‹ãŸãŠã‚„", "ã‹ãŸã¦ãŠã¡", "ã‹ãŸã¯ã„", "ã‹ãŸã‚", 
        "ã‹ãŸã‚", "ãŒã¡ã‚ƒã‚", "ã‹ã¤ãã‚„", "ã‹ã£ãŸã„", "ãŒã£ã·ã‚Šã‚ˆã¤", "ã‹ã£ãº", "ã‹ã¿ãŒãŸã®ãœã„ã‚ã", "ã‹ã‚Šã°ã‚‰", "ã‹ã‚ã‹ã¶ã‚Š", 
        "ã‹ã‚ãã‚Š", "ã‹ã‚ã‚€ã“ã†", "ã‹ã‚ã‚‰ã“ã˜ã", "ã‹ã‚“ã”ãµ", "ã‹ã‚“ã¤ã†", "ãã˜ã‚‹ã—", "ãã¡", "ãã¡ãŒã„", "ãã¡ãŒã„ã–ãŸ", "ãã¡ãŒã„ã«ã¯ã‚‚ã®", 
        "ãã£ã¡ã‚‡", "ãã‚…ã†ã˜", "ãã‚…ã†ã‚’ã™ãˆã‚‹", "ãã‚‡ã†ã", "ãã‚‡ã†ãã®ã•ãŸ", "ãã‚‡ã†ã˜ã‚‡", "ãã‚‡ã†ã˜ã‚“", "ãã‚‡ãµ", "ããƒ¼ã‚Šãƒ¼", "ããšã‚„", 
        "ãã©ã‚“", "ãã³ãã‚Š", "ãã¿ã¨ã‚Šã‚„", "ãã‚‹ã†", "ãã‚", "ãã‚ã‚“ã¼", "ãã‚ãˆã“ã‚€", "ãã‚“ã«", "ãã‚“ã‚‚ã†ãã†ã‚’ãªã§ã‚‹", "ã’ã„ã«ã‚“", 
        "ã’ãƒ¼ã›ã‚“", "ã’ã˜ã‚‡", "ã‘ã£ã¨ã†", "ã‘ã¨ã†", "ã’ãªã‚“", "ã‘ã‚“ãœã‚“ãªã‚‹ã›ã„ã—ã‚“ã¯ã‘ã‚“ãœã‚“ãªã‚‹ã—ã‚“ãŸã„ã«ã‚„ã©ã‚‹", "ã’ã‚“ãªã¾", "ã”ã†ã‹ã‚“", "ã“ã†ã—ã‚“ã“ã", "ã“ã†ã—ã‚“ã˜ã‚‡", 
        "ã”ã†ã³ã‚‡ã†", "ã“ã†ãµ", "ã“ã†ãµ", "ã“ã†ãµ", "ã“ã†ã‚‚ã†ã˜ã‚“", "ã“ãã˜ã‚“", "ã“ã‘", "ã“ã˜ã„ã‚“", "ã“ã˜ã", "ã“ãã†", 
        "ã“ã¥ã‹ã„", "ã“ã©ã‚‚", "ã“ã³ã¨", "ã”ã¿ã‚„", "ã“ã‚ã—", "ã•ã‹ãªã‚„", "ã–ãã‚“", "ã•ã¤", "ã•ã‚‰ãã‚“", "ã•ã‚‰ã¶ã‚Œã£ã©", 
        "ã•ã‚“ã‹ã‚“ã›ã„ã°ã¤", "ã•ã‚“ã”ãã˜ã‚“", "ã•ã‚“ã™ã‘", "ã•ã‚“ã°", "ã—ãã‚‚ã†", "ã—ãª", "ã—ãªã˜ã‚“", "ã—ãªãã°", "ã—ãªã¡ã", "ã—ãªã‚Šã‚‡ã†ã‚Š", 
        "ã—ã®ã†ã“ã†ã—ã‚‡ã†", "ã˜ã·ã—ãƒ¼", "ã˜ã¸ã„ã—ã‚‡ã†ã˜", "ã—ã¾", "ã˜ã¾ã‚ã‚Š", "ã˜ã‚ƒã£ã·", "ã˜ã‚ƒã‚Š", "ã˜ã‚…ãƒ¼", "ã˜ã‚…ã†ã„", "ã—ã‚…ã†ã›ã‚“ã‚„", 
        "ã—ã‚…ã†ã¡ã‚‡ã†", "ã˜ã‚‡ã†", "ã—ã‚‡ã†ãŒã„ã—ã‚ƒ", "ã—ã‚‡ã†ãã ãŠã—ã«ãªã‚‹", "ã˜ã‚‡ã†ãµ", "ã˜ã‚‡ã†ãµ", "ã˜ã‚‡ãã‚…ã†", "ã—ã‚‡ãã¶ã¤ã«ã‚“ã’ã‚“", "ã˜ã‚‡ã‘ã¤", "ã˜ã‚‡ã“ã†", 
        "ã˜ã‚‡ã•ã‚“ã·", "ã—ã‚‡ã˜ã‚‡ã•ã", "ã—ã‚‡ã˜ã‚‡ã»ã†", "ã˜ã‚‡ã¡ã‚…ã†", "ã—ã‚‡ã£ã“ã†", "ã—ã‚‰ã£ã“", "ã—ã‚Šã¬ãã„", "ã—ã‚“ã—ã‚‡ã†ã˜", "ã—ã‚“ã—ã‚‡ã†ã—ã‚ƒ", "ã—ã‚“ã¸ã„ã¿ã‚“", 
        "ãšãƒ¼ã˜ã‚ƒãƒ¼", "ã™ã‘", "ã™ã‘ã“ã¾ã—", "ã™ã¡ã‚…ã‚ãƒ¼ã§ã™", "ã™ã¹ã‚Šã©ã‚", "ãšã‚‰ã‹ã‚‹", "ã™ã‚‰ã‚€", "ã›ã„ã•ã„", "ã›ã„ã—ã‚“ã„ã˜ã‚‡ã†", "ã›ã„ã—ã‚“ã¶ã‚“ã‚Œã¤ã³ã‚‡ã†", 
        "ã›ã„ã¯ã", "ã›ã‚€ã—", "ã›ã‚“ã˜ã‚“", "ã›ã‚“ã™ã„ãµ", "ã›ã‚“ãšã‚Š", "ã›ã‚“ã‚ã“ã†ãµ", "ãã†ã˜ãµ", "ãã†ã˜ãµ", "ãã†ã‚„ããµ", "ãã ã¡ã‚ˆã‚Šã†ã˜", 
        "ã ã„ã•ã‚“ã”ã", "ã ã„ã—ã‚‡ã‚„", "ãŸã„ã‚ã‚“ã›ã„ãµ", "ãŸã„ã‚ã‚“ã¯ã’", "ãŸã‘ã®ã“ã„ã—ã‚ƒ", "ãŸã“ã¹ã‚„", "ãŸãŸã", "ã ã£ã¡ã¾ã‚“", "ãŸã¾ã¶ãã‚ã™ã˜ãŸã‚ã†", "ãŸã‚Šãã»ã‚“ãŒã‚“", 
        "ãŸã‚ŒãªãŒã™", "ã¡ãˆãŠãã‚Œ", "ã¡ã‹ã‚", "ã¡ã™ã˜", "ã¡ã³", "ã¡ã»ã†ã—ã‚‡ã†", "ã¡ã‚ƒã‚Šã‚“ã“", "ã¡ã‚ƒã‚“ã“ã‚", "ã¡ã‚…ã†ãã‚‡ã†", "ã¡ã‚‡ã†ã›ã‚“ã›ã„ã°ã¤", 
        "ã¡ã‚‡ã†ã›ã‚“ã«ã‚“ã˜ã‚“", "ã¡ã‚‡ã‚“", "ã¡ã‚“ã°", "ã¤ã‚ŠãŒã", "ã¤ã‚Œã”", "ã¤ã‚“ã¼", "ã¤ã‚“ã¼ã•ã˜ã", "ã¦ã„ã‹ã„ã¯ã¤ã“ã", "ã¦ã„ã®ã†", "ã¦ã„ã®ã†ã˜", 
        "ã§ã‹", "ã§ã‹ã›ã", "ã§ã£ã¡", "ã§ã‚‚ã©ã‚Š", "ã¦ã‚“ã•ã„ã¨ãã‚‡ã†ã˜ã‚“ã¯ã‹ã¿ã²ã¨ãˆ", "ã¦ã‚“ã¼ã†", "ã©ã‹ãŸ", "ã¨ãã—ã‚…ãŒã£ãã‚…ã†", "ã¨ãã—ã‚…ãŒã£ã“ã†", "ã¨ãã—ã‚…ã¶ã‚‰ã", 
        "ã©ã‘ã‚“ã‚„", "ã©ã“ã†", "ã¨ã“ã‚„", "ã©ã–ãˆã‚‚ã‚“", "ã¨ã•ã¤", "ã¨ã•ã¤ã˜ã‚‡ã†", "ã¨ã•ã¤ã«ã‚“", "ã©ã•ã¾ã‚ã‚Š", "ã©ã˜ã‚“", "ã¨ã‚‚ã‹ã›ã", 
        "ã©ã‚‚ã‚Š", "ã©ã‚„", "ã©ã‚„ãŒã„", "ã¨ã‚„ã¾ã®ã•ã‚“ã™ã‘", "ã¨ã‚‹ã“ã˜ã‚‡ã†", "ã¨ã‚‹ã“ã¶ã‚", "ã©ã‚“ã³ã‚ƒãã—ã‚‡ã†", "ãªãŠã‚“", "ãªã‚“ã›ã‚“", "ãªã‚“ã¶ã®ã—ã‚ƒã‘ã®ã¯ãªã¾ãŒã‚Š", 
        "ã«ãŒãƒ¼", "ã«ãã‚", "ã«ã”ã†", "ã«ã“ã‚ˆã‚“", "ã«ã»ã‚“ã®ã¡ã¹ã£ã¨", "ã«ã‚“ãã", "ã«ã‚“ã´ã«ã‚“", "ã«ã‚“ã·", "ã­ã“ã°ã°", "ã®ã†ãµ", 
        "ã®ã†ã¾ããˆã‚“", "ã®ã³", "ã¯ãƒ¼ãµ", "ã±ãƒ¼ã¾ã‚„", "ã°ã‹ã¡ã‚‡ã‚“ã‹ã‚ã‚‰", "ã°ã‹ã§ã‚‚ã¡ã‚‡ã‚“ã§ã‚‚", "ã¯ãã¡", "ã±ãã‚‹", "ã°ãã‚ã†", "ã¯ã—ãŸã‚", 
        "ã¯ã ã„ã‚", "ã°ãŸã‚„", "ã¯ã£ãã‚‡ã†ã™ã‚‹", "ã°ã¦ã„", "ã±ã‚“ã™ã‘", "ã°ã‚“ãŸ", "ã¯ã‚“ã¨ã†ã˜ã‚“", "ã¯ã‚“ã°", "ã²ã‹ã‚Œã‚‚ã®", "ã³ã£ã“", 
        "ã²ã«ã‚“", "ã²ã‚‚", "ã²ã‚ƒãã—ã‚‡ã†", "ã²ã‚„ã¨ã„", "ã²ã‚“ã®ã†", "ã¶ãŠã¨ã“", "ãµã‹ã—ã‚‡ãã¿ã‚“", "ãµã", "ãµã‘ã„", "ãµã˜ã®ã‚„ã¾ã„", 
        "ã¶ã™", "ã¶ãŸã°ã“", "ã¶ã¤", "ãµã¿ãã‚Šã°ã‚“", "ã¶ã‚‰ã„ã‚“ã©ãŸã£ã¡", "ã¶ã‚‰ã", "ãµã‚ã†ã˜", "ãµã‚ã†ã—ã‚ƒ", "ãºã„ã‹ã‚“", "ãºã„ã¡ã‚…ã†", 
        "ã¼ã†ãš", "ã»ãã›ã‚“", "ã½ã“ãºã‚“", "ã»ã›ã‚“ã“ã†ãµ", "ã½ã£ã½ãƒ¼ã‚„", "ã»ã¼", "ã½ã‚Šã“ã†", "ã»ã‚“ã”ã—ã‚’ã„ã‚Œã‚‹", "ã½ã‚“ã³ã", "ã»ã‚“ã¼ã—", 
        "ã¾ãˆã¤ã", "ã¾ã˜ã‚‡ã£ã“", "ã¾ãŸã«ã‹ã‘ã‚‹", "ã¾ã¡ã„ã—ã‚ƒ", "ã¾ã‚“ã“", "ã¾ã‚“ã—ã‚…ã†", "ã¿ã‹ã„ã˜ã‚“", "ã¿ã‹ã„ã¯ã¤ã“ã", "ã¿ã¤ãã¡", "ã¿ã¶ã‚“", 
        "ã¿ã¼ã†ã˜ã‚“", "ã¿ã‚‚ã¨ã¡ã‚‡ã†ã•", "ã‚€ã“ã‚’ã¨ã‚‹", "ã‚€ã™ã‚ã‚’ã‹ãŸã¥ã‘ã‚‹", "ã‚ã„ã‚‚ã‚“ã“ã†", "ã‚ã‹ã‘", "ã‚ãã‚‰", "ã‚ãã‚‰ã˜ã¾", "ã‚ãã‚‰ã°ã‚“ã‚’ãŠã™", "ã‚ãã‚‰ã¸ã³ã«ãŠã˜ãš", 
        "ã‚ãã‚‰ã‚ã£ã½ã†", "ã‚ã£ã‹ã¡", "ã‚‚ã†ã‚ã„ã™ã‚‹", "ã‚‚ã†ã“ã—ã‚‡ã†", "ã‚‚ã†ã˜ã‚“", "ã‚‚ã†ã‚‚ã", "ã‚‚ã‚“ã‚‚ã†", "ã‚„ãƒ¼ã•ã¾", "ã‚„ãŠã‚„", "ã‚„ãã¶ãã", 
        "ã‚„ã•ãã‚Œ", "ã‚„ã°ã„", "ã‚„ã¶ã„ã—ã‚ƒ", "ã‚„ã¶ã«ã‚‰ã¿", "ã‚„ã‚“ããƒ¼", "ã‚„ã‚“ãã„", "ã‚†ã†ã³ã‚“ãµ", "ã‚†ã†ã³ã‚“ã‚„", "ã‚ˆã†ã”", "ã‚ˆã†ã‚ã†ã„ã‚“", 
        "ã‚ˆã›ã°", "ã‚ˆã¤", "ã‚ˆã¤ã‚ã—", "ã‚ˆã¤ã¤ã˜", "ã‚ˆã‚ã«ã‚„ã‚‹", "ã‚ˆã‚Šã‚", "ã‚‰ã„ã³ã‚‡ã†", "ã‚‹ã‚“ãºã‚“", "ã‚Œã„ã˜ã‚‡ã†", "ã‚Œã‚“ã¨ã’ã‚“ãã—", 
        "ã‚ã†ã°", "ã‚ã†ã‚€ã—ã‚ƒ", "ã‚ã™ã‘", "ã‚ã‚“ã±ã‚Š"
    ]
    inappropriate_words_k = [
        "ã‚¢ã‚¤ãƒŒç³»", "åˆã„ã®å­", "é’å§¦", "ã‚¢ã‚«", "æ˜ç›²", "è¶³åˆ‡ã‚Š", "è¶³ã‚’æ´—ã†", "å½“ã¦é¦¬", "ã‚¢ãƒ¡å…¬", "ã‚ã‚‰ã‚ã‚“", 
        "ã‚¢ãƒ«ä¸­", "æŒ‰æ‘©", "å®¶æŸ„", "ã‚¤ã‚«ã‚µãƒ", "èº„", "ä¼Šå‹¢ä¹é£Ÿ", "ã‚¤ã‚¿å…¬", "æ¿å‰", "ã„ã¡ã‚ƒã‚‚ã‚“", "ç”°èˆ", 
        "çŠ¬æ®ºã—", "ç§»æ°‘", "ã‚¤ãƒ¢", "ã‚¤ãƒ³ãƒã‚­", "ã‚¤ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³å˜˜ã¤ã‹ãªã„", "æ·«å£²", "è£æ—¥æœ¬", "ã†ã‚“ã“", "é‹ã¡ã‚ƒã‚“", 
        "ã‚¨ã‚¹ã‚­ãƒ¢ãƒ¼", "ç©¢å¤š", "è¶Šå¾Œã®ç±³ã¤ã", "ã‚¨ãƒã‚¼ãƒ³ã‚¯ãƒ©ã‚²", "ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼", "ï¼¯ï¼¬", "ã‚ªãƒ¼ãƒ«ãƒ‰ãƒŸã‚¹", "ã‚ªã‚«ãƒ", 
        "æ²–ä»²ä»•", "å”–", "è½äººéƒ¨è½", "è½ã¡ã“ã¼ã‚Œ", "è½ã¨ã—å‰", "æººã‚Œæ­»ã¬", "ãŠå·¡ã‚Š", "è¡¨æ—¥æœ¬", "è¦ªæ–¹", "ãŠã‚ã„ã‚„", 
        "å¥³å­ä¾›", "å¥³ã®è…ã£ãŸã‚ˆã†ãª", "éš åŠ", "å¤–äºº", "è›™ã®å­ã¯è›™", "ã‚¬ã‚­", "ç¢ºä¿¡çŠ¯", "æ‹¡å¼µå“¡", "æ‹¡å¼µå›£", 
        "æ‹¡å¼µå›£é•·", "å®¶ç³»", "éå»å¸³", "ã‚¬ã‚µ", "ã‹ã•ã£ã‹ã", "ç‰‡è¶³", "ç‰‡è¦ª", "ç‰‡æ‰‹è½ã¡", "ç‰‡è‚º", "ç‰‡ç›®", 
        "ç‰‡ç«¯", "ãŒã¡ã‚ƒç›®", "æ‹…ãå±‹", "ã‹ã£ãŸã„", "ãŒã£ã·ã‚Šå››ã¤", "ã‚«ãƒƒãƒš", "ä¸Šæ–¹ã®è´…å…­", "å€Ÿã‚Šè…¹", "çš®è¢«ã‚Š", 
        "çš®åˆ‡ã‚Š", "å·å‘ã“ã†", "æ²³åŸä¹é£Ÿ", "çœ‹è­·å©¦", "å§¦é€š", "ã‚­å°", "ã‚­ãƒ", "æ°—é•ã„", "æ°—é•ã„æ²™æ±°", "æ°—é•ã„ã«åˆƒç‰©", 
        "ãã£ã¡ã‚‡", "çµ¦ä»•", "ç¸ã‚’æ®ãˆã‚‹", "ç‹‚æ°—", "ç‹‚æ°—ã®æ²™æ±°", "ç‹‚å¥³", "ç‹‚äºº", "æ¼å¤«", "è‹¦åŠ›", "å±‘å±‹", 
        "æ„šéˆ", "é¦–åˆ‡ã‚Š", "æ±²ã¿å–ã‚Šå±‹", "ç‹‚ã†", "ã‚¯ãƒ­", "é»’ã‚“ã¼", "ãã‚ãˆè¾¼ã‚€", "ã‚¯ãƒ³ãƒ‹", "ç¾¤ç›²è±¡ã‚’ãªã§ã‚‹", "èŠ¸äºº", 
        "ã‚²ãƒ¼ã‚»ãƒ³", "ä¸‹å¥³", "è¡€çµ±", "æ¯›å”", "ä¸‹ç”·", "å¥å…¨ãªã‚‹ç²¾ç¥ã¯å¥å…¨ãªã‚‹èº«ä½“ã«å®¿ã‚‹", "ã‚²ãƒ³ãƒŠãƒ", "å¼·å§¦", "å¾Œé€²å›½", "èˆˆä¿¡æ‰€", 
        "æ¥­ç—…", "é‰±å¤«", "å·¥å¤«", "å‘å¤«", "ç´…æ¯›äºº", "é»’äºº", "è™šä»®", "å­¤å…é™¢", "ä¹é£Ÿ", "å°åƒ§", 
        "å°ä½¿ã„", "å­ä¾›", "å°äºº", "ã‚´ãƒŸå±‹", "ã‚³ãƒ­ã‚·", "é­šå±‹", "ã‚¶ã‚®ãƒ³", "ã‚µãƒ„", "ã‚µãƒ©é‡‘", "ã‚µãƒ©ãƒ–ãƒ¬ãƒƒãƒ‰", 
        "ä¸‰éŸ“å¾ä¼", "ä¸‰å›½äºº", "ä¸‰åŠ©", "ç”£å©†", "è‰²ç›²", "æ”¯é‚£", "æ”¯é‚£äºº", "æ”¯é‚£è•éº¦", "æ”¯é‚£ç«¹", "æ”¯é‚£æ–™ç†", 
        "å£«è¾²å·¥å•†", "ã‚¸ãƒ—ã‚·ãƒ¼", "è‡ªé–‰ç—‡å…", "ã‚·ãƒ", "åœ°å›ã‚Š", "ã‚¸ãƒ£ãƒƒãƒ—", "ã‚¸ãƒ£ãƒª", "ã‚¸ãƒ¥ãƒ¼", "ç£åŒ»", "å‘¨æ—‹å±‹", 
        "é…‹é•·", "å¬¢", "éšœå®³è€…", "å°†æ£‹å€’ã—ã«ãªã‚‹", "æƒ…å¤«", "æƒ…å©¦", "å¥³çµ¦", "æ¤ç‰©äººé–“", "å¥³å‚‘", "å¥³å·¥", 
        "åŠ©ç”£å©¦", "å‡¦å¥³ä½œ", "å‡¦å¥³å³°", "å¥³ä¸­", "è·å·¥", "ã—ã‚‰ã£ã“", "å°»æ‹­ã„", "å¿ƒéšœå…", "å¿ƒéšœè€…", "æ–°å¹³æ°‘", 
        "ã‚ºãƒ¼ã‚¸ãƒ£ãƒ¼", "ã‚¹ã‚±", "ã™ã‘ã“ã¾ã—", "ã‚¹ãƒãƒ¥ãƒ¯ãƒ¼ãƒ‡ã‚¹", "æ»‘ã‚Šæ­¢ã‚", "ãšã‚‰ã‹ã‚‹", "ã‚¹ãƒ©ãƒ ", "æ­£å¦»", "ç²¾ç¥ç•°å¸¸", "ç²¾ç¥åˆ†è£‚ç—…", 
        "ç²¾è–„", "å‚´åƒ‚", "é®®äºº", "æ½œæ°´å¤«", "åƒæ‘ºã‚Š", "ç·šè·¯å·¥å¤«", "æƒé™¤å©¦", "æƒé™¤å¤«", "é›‘å½¹å¤«", "è‚²ã¡ã‚ˆã‚Šæ°",
    ]
    #sex = read_lines_from_txt("./dicts/Sexual.txt")
    #sexbopo = read_lines_from_txt("./dicts/Sexual_bopo.txt")
    #sexmask = read_lines_from_txt("./dicts/Sexual_mask.txt")
    #bopo = read_lines_from_txt("./dicts/bopo.txt")
    #Offense = read_lines_from_txt("./dicts/Offense.txt")
    #combined_list = inappropriate_words_h + inappropriate_words_k + sex + sexbopo + sexmask + bopo + Offense
    combined_list = inappropriate_words_h + inappropriate_words_k
    return contains_inappropriate_words(words,combined_list)
def read_lines_from_txt(file_path):
        lines = []
        with open(file_path, 'r', encoding='utf-8') as file:
            for line in file:
                lines.append(line.strip())
        return lines

def getTWvideo(URL):
    t = f"https://twidropper.com/request?action=add&url={URL}"
    return requests.get(t).json()

def create_othello_board():
    board = [
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 1, -1, 0, 0, 0],
        [0, 0, 0, -1, 1, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0]
    ]
    return board

def create_playable_othello_flex_message(board):
    header_contents = [
        {"type": "text", "text": "ã‚ªã‚»ãƒ­ã‚²ãƒ¼ãƒ ", "weight": "bold", "size": "xl"}
    ]
    body_contents = []
    for i in range(8):
        row_contents = []
        for j in range(8):
            background_color = "#00FF00" if board[i][j] == 0 else "#000000" if board[i][j] == 1 else "#FFFFFF"
            label = "â—" if board[i][j] == 1 else "â—‹" if board[i][j] == -1 else " "
            button = {
                "type": "button",
                "action": {"type": "postback", "label": label, "data": f"move {i} {j}"},
                "color": "#FFFFFF",
                "height": "sm",
                "style": "primary",
                "gravity": "center"
            }
            row_contents.append({
                "type": "box",
                "layout": "vertical",
                "contents": [button],
                "backgroundColor": background_color
            })
        body_contents.append({"type": "box", "layout": "horizontal", "contents": row_contents, "spacing": "md"})
    
    flex_message = {
        "type": "bubble",
        "header": {"type": "box", "layout": "vertical", "contents": header_contents},
        "body": {"type": "box", "layout": "vertical", "contents": body_contents, "spacing": "md"}
    }
    return flex_message



app = Flask(__name__)
token = '/07/lu+hbA3W8CWnXpOEJ0d5KinfqH51vSPIC6wX2CdzDc9QLOy85cS+GRoqbeaLvWYnk+c15uc14mxx0BM3UrRK073jA9g/nvDLadVqRblahrzCGxrbdSs1tTho9V+zEP5caL0emkqHB7NmVb7QjQdB04t89/1O/w1cDnyilFU='
configuration = Configuration(access_token='/07/lu+hbA3W8CWnXpOEJ0d5KinfqH51vSPIC6wX2CdzDc9QLOy85cS+GRoqbeaLvWYnk+c15uc14mxx0BM3UrRK073jA9g/nvDLadVqRblahrzCGxrbdSs1tTho9V+zEP5caL0emkqHB7NmVb7QjQdB04t89/1O/w1cDnyilFU=')
handler = WebhookHandler('a555d82dacf40144c6480580ec728a21')

#cl = CHRLINE("u8c3c21d9e5dfd137b196882adb4408cd:aWF0OiAxMDA2OTUwMjE5NjAK..V2QpW24jSGogN/H5p9k8WCWr1Xk=",device="ANDROID",useThrift=True)

status = livejson.File('data.json', True, False, 4)
lvdata = livejson.File('lv.json', True, False, 4)
slot = livejson.File('slot.json', True, False, 4)
unsend = livejson.File('unsend.json', True, False, 4)
msgdata = livejson.File('msgdata.json', True, False, 4)
groupmember = livejson.File('memberlist.json', True, False, 4)

NG = ["ã‚¨ãƒƒã‚¯ã‚¹ãƒ“ãƒ‡ã‚ª","sex","Sex","sEx","SEx","SEX","SeX","sEx","xvideos","porn","pornhub","ã‚»ãƒƒã‚¯ã‚¹","ã›ã£ãã™","æ­»ã­","ã—ã­","4ã­","ã—ã­ã‚ˆ","é¦–åŠã‚Š","è‡ªæ®º","ä»–æ®º","æ®º","æ®ºå®³","äº¤é€šäº‹æ•…","https://","http://","æ®ºã™ã",".com","f5.si",".net",".co","duckduckgo","google.com"]

ngrokURL = ""

helpmessage = """ä½¿ã„æ–¹
ãƒ˜ãƒ«ãƒ—
>> ã“ã‚Œ
ãƒ†ã‚¹ãƒˆ
>> å‹•ä½œç¢ºèª
ãƒ©ãƒ³ã‚­ãƒ³ã‚°
>> è‡ªåˆ†ã®æµ®ä¸Šç‡ãƒ¬ãƒ™ãƒ«ã‚’å‡ºã—ã¾ã™
è¿½åŠ :[åå¿œãƒ¯ãƒ¼ãƒ‰]:[è¿”ç­”]
>> åå¿œãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™
å‰Šé™¤:[åå¿œãƒ¯ãƒ¼ãƒ‰]
>> åå¿œãƒ¯ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã™
ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§
>> åå¿œãƒ¯ãƒ¼ãƒ‰ä¸€è¦§ã‚’è¡¨ç¤ºã•ã›ã¾ã™
leave
>> é€€ä¼šã—ã¾ã™
å‚åŠ æŒ¨æ‹¶è¨­å®š
>> å‚åŠ æŒ¨æ‹¶ã®è¨­å®šã‚’ã—ã¾ã™
ãƒãƒ³ãƒãƒ­
>> ãƒãƒ³ãƒãƒ­ã‚²ãƒ¼ãƒ ã‚’ã—ã¾ã™(è¿‘æ—¥å…¬é–‹äºˆå®š)"""

def show_and_get_result(TF):
    if TF == False:
        REEL_MARK_LIST = ('7', 'BAR', 'ğŸ’', 'ğŸ', 'Reply','â™¢','â™¢', 'Reply', 'ğŸ','Reply','â™¢','Reply','ğŸ')
        result_list = []
        for _ in range(3):
            index = random.randint(0, 12)
            result = REEL_MARK_LIST[index]
            result_list.append(result)
        result_all = ''.join(result_list)
        return result_all
    if TF == True:
        REEL_MARK_LIST = ('7', 'ğŸ', '7','7','7', '7', '7','7','7','7','ğŸ','ğŸ','7')
        result_list = []
        for _ in range(3):
            index = random.randint(0, 12)
            result = REEL_MARK_LIST[index]
            result_list.append(result)
        result_all = ''.join(result_list)
        return result_all
    else:
        pass

def slotgame(UserId):
    if slot[UserId]["BB"] == False:
        if 3 < slot[UserId]["credit"]:
            marks = show_and_get_result(False)
            slot[UserId]["credit"] -= 3
            if marks == '777':
                slot[UserId]["credit"] +=350
                slot[UserId]["BB"] = True
                slot[UserId]["BBnum"] = random.choice([3,6,9,12,15,18,21,30])
                return "7/7/7 150ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç²å¾—[GoGo]"
            elif marks == 'BARBARBAR':
                slot[UserId]["credit"] +=60
                return "BAR/BAR/BAR 60ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç²å¾—"
            elif marks == 'ğŸğŸğŸ':
                slot[UserId]["credit"] += 40
                return "ğŸ/ğŸ/ğŸ 40ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç²å¾—"
            elif marks == 'ReplyReplyReply':
                return "Reply/Reply/Reply ã‚‚ã£ã‹ã„å¼•ã‘ã‚‹ã‚ˆ"
            elif marks is not None and marks[0:1] == 'ğŸ’':
                slot[UserId]["credit"] += 20
                return f"{marks} 20ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç²å¾—"
            else:
                return f"{marks} ã¯ãšã‚Œ"
        else:
            return "3ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆä»¥ä¸Šãªã„ã¨ã‚¹ãƒ­ãƒƒãƒˆã‚’å›ã›ã¾ã›ã‚“"
    elif slot[UserId]["BB"] == True:
        if 3 < slot[UserId]["credit"]:
            marks = show_and_get_result(True)
            slot[UserId]["credit"] -= 3
            slot[UserId]["BBnum"] -= 1
            if not slot[UserId]["BBnum"] == 0:
                if marks == '777':
                    slot[UserId]["credit"] +=350
                    return "7/7/7 350ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç²å¾—[BB]"
                elif marks == 'ğŸğŸğŸ':
                    slot[UserId]["credit"] += 40
                    return "ğŸ/ğŸ/ğŸ 120ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç²å¾—[BB]"
                else:
                    return f"{marks} ã¯ãšã‚Œ[BB]"
            else:
                slot[UserId]["BB"] = False
                marks = show_and_get_result(False)
                if marks == '777':
                    slot[UserId]["credit"] +=350
                    slot[UserId]["BB"] = True
                    slot[UserId]["BBnum"] = random.choice(["3","6","9","12","15","18","21","30"])
                    return "7/7/7 150ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç²å¾—[GoGo]"
                elif marks == 'BARBARBAR':
                    slot[UserId]["credit"] +=60
                    return "BAR/BAR/BAR 60ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç²å¾—"
                elif marks == 'ğŸğŸğŸ':
                    slot[UserId]["credit"] += 40
                    return "ğŸ/ğŸ/ğŸ 40ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç²å¾—"
                elif marks == 'ReplyReplyReply':
                    return "Reply/Reply/Reply ã‚‚ã£ã‹ã„å¼•ã‘ã‚‹ã‚ˆ"
                elif marks is not None and marks[0:1] == 'ğŸ’':
                    slot[UserId]["credit"] += 20
                    return f"{marks} 20ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç²å¾—"
                else:
                    return f"{marks} ã¯ãšã‚Œ"
        else:
            return "3ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆä»¥ä¸Šãªã„ã¨ã‚¹ãƒ­ãƒƒãƒˆã‚’å›ã›ã¾ã›ã‚“"
def youtubeSearch(word,limit):
    base = {
  "type": "carousel",
  "contents": []
}
    result = Search(word, limit = limit).result()['result']
    print(len(result))
    ct = 0
    for data in result:
        if ct == 11:
            break
        if data['type'] == 'video':
            ct += 1
            flat = {
      "type": "bubble",
      "hero": {
        "type": "image",
        "url": data['thumbnails'][0]['url'],
        "size": "full",
        "action": {
          "type": "uri",
          "label": "URL",
          "uri": f"https://www.youtube.com/watch?v={data['id']}"
        }
      },
      "body": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "text",
            "text": data['channel']['name'],
            "weight": "bold",
            "wrap": True,
            "align": "center"
          },
          {
            "type": "text",
            "wrap": True,
            "text": data["title"]
          }
        ]
      },
      "footer": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "text",
            "text": "Â©2024 moyashi bot",
            "size": "sm",
            "weight": "bold",
            "align": "center"
          }
        ],
        "backgroundColor": "#7FCCE3"
      }
    }
            base["contents"].append(flat)
    return base

flex_helpmessage = {
  "type": "carousel",
  "contents": [
    {
      "type": "bubble",
      "header": {
        "type": "box",
        "layout": "horizontal",
        "contents": [
          {
            "type": "text",
            "text": "ä½¿ã„æ–¹ä¸€è¦§",
            "weight": "bold",
            "size": "lg",
            "margin": "md",
            "align": "start"
          }
        ]
      },
      "body": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "box",
            "layout": "horizontal",
            "contents": [
              {
                "type": "text",
                "text": "è‡ªåˆ†ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°",
                "size": "md",
                "color": "#000000",
                "flex": 1,
                "weight": "bold",
                "margin": "none"
              },
              {
                "type": "button",
                "action": {
                  "type": "message",
                  "label": "è¡¨ç¤º",
                  "text": "ãƒ©ãƒ³ã‚­ãƒ³ã‚°"
                },
                "height": "sm",
                "flex": 0,
                "margin": "lg",
                "offsetTop": "xs",
                "offsetStart": "md",
                "offsetEnd": "xxl",
                "offsetBottom": "xxl"
              }
            ]
          },
          {
            "type": "box",
            "layout": "horizontal",
            "contents": [
              {
                "type": "text",
                "text": "åå¿œãƒ¯ãƒ¼ãƒ‰ä¸€è¦§",
                "size": "md",
                "color": "#000000",
                "flex": 1,
                "weight": "bold",
                "margin": "none"
              },
              {
                "type": "button",
                "action": {
                  "type": "message",
                  "label": "è¡¨ç¤º",
                  "text": "ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§"
                },
                "height": "sm",
                "flex": 0,
                "margin": "lg",
                "offsetTop": "xs",
                "offsetStart": "md",
                "offsetEnd": "xxl",
                "offsetBottom": "xxl"
              }
            ]
          },
          {
            "type": "box",
            "layout": "horizontal",
            "contents": [
              {
                "type": "text",
                "text": "ã‚¹ãƒ­ãƒƒãƒˆ",
                "size": "md",
                "color": "#000000",
                "flex": 1,
                "weight": "bold",
                "margin": "none"
              },
              {
                "type": "button",
                "action": {
                  "type": "message",
                  "label": "è¡¨ç¤º",
                  "text": "ã‚¹ãƒ­ãƒƒãƒˆhelp"
                },
                "height": "sm",
                "flex": 0,
                "margin": "lg",
                "offsetTop": "xs",
                "offsetStart": "md",
                "offsetEnd": "xxl",
                "offsetBottom": "xxl"
              }
            ]
          },
          {
            "type": "box",
            "layout": "horizontal",
            "contents": [
              {
                "type": "text",
                "text": "å‚åŠ æŒ¨æ‹¶è¨­å®š",
                "size": "md",
                "color": "#000000",
                "flex": 1,
                "weight": "bold",
                "margin": "none"
              },
              {
                "type": "button",
                "action": {
                  "type": "message",
                  "label": "è¡¨ç¤º",
                  "text": "å‚åŠ æŒ¨æ‹¶è¨­å®š"
                },
                "height": "sm",
                "flex": 0,
                "margin": "lg",
                "offsetTop": "xs",
                "offsetStart": "md",
                "offsetEnd": "xxl",
                "offsetBottom": "xxl"
              }
            ]
          },
          {
            "type": "box",
            "layout": "horizontal",
            "contents": [
              {
                "type": "text",
                "text": "åå¿œãƒ¯ãƒ¼ãƒ‰è¿½åŠ ",
                "size": "md",
                "color": "#000000",
                "flex": 1,
                "weight": "bold",
                "margin": "none"
              },
              {
                "type": "button",
                "action": {
                  "type": "message",
                  "label": "è¡¨ç¤º",
                  "text": "åå¿œãƒ¯ãƒ¼ãƒ‰è¿½åŠ "
                },
                "height": "sm",
                "flex": 0,
                "margin": "lg",
                "offsetTop": "xs",
                "offsetStart": "md",
                "offsetEnd": "xxl",
                "offsetBottom": "xxl"
              }
            ]
          },
          {
            "type": "box",
            "layout": "horizontal",
            "contents": [
              {
                "type": "text",
                "text": "ãŠã¿ãã˜",
                "size": "md",
                "color": "#000000",
                "flex": 1,
                "weight": "bold",
                "margin": "none"
              },
              {
                "type": "button",
                "action": {
                  "type": "message",
                  "label": "è¡¨ç¤º",
                  "text": "ãŠã¿ãã˜"
                },
                "height": "sm",
                "flex": 0,
                "margin": "lg",
                "offsetTop": "xs",
                "offsetStart": "md",
                "offsetEnd": "xxl",
                "offsetBottom": "xxl"
              }
            ]
          }
        ]
      },
      "footer": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "text",
            "text": "Â©2024 moyashi bot",
            "flex": 0,
            "size": "sm",
            "align": "center",
            "margin": "xs",
            "weight": "bold"
          }
        ],
        "backgroundColor": "#7FCCE3",
        "flex": 0
      },
      "styles": {
        "footer": {
          "separator": True
        }
      }
    },
    {
      "type": "bubble",
      "header": {
        "type": "box",
        "layout": "horizontal",
        "contents": [
          {
            "type": "text",
            "text": "ä½¿ã„æ–¹ä¸€è¦§2",
            "weight": "bold",
            "size": "lg",
            "margin": "md",
            "align": "start"
          }
        ]
      },
      "body": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "box",
            "layout": "vertical",
            "contents": [
              {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                  {
                    "type": "text",
                    "text": "åå¿œãƒ¯ãƒ¼ãƒ‰å‰Šé™¤",
                    "size": "md",
                    "color": "#000000",
                    "flex": 1,
                    "weight": "bold",
                    "margin": "none",
                    "action": {
                      "type": "message",
                      "label": "è¡¨ç¤º",
                      "text": "åå¿œãƒ¯ãƒ¼ãƒ‰å‰Šé™¤"
                    }
                  },
                  {
                    "type": "button",
                    "action": {
                      "type": "message",
                      "label": "è¡¨ç¤º",
                      "text": "åå¿œãƒ¯ãƒ¼ãƒ‰å‰Šé™¤"
                    },
                    "height": "sm",
                    "flex": 0,
                    "margin": "lg",
                    "offsetTop": "xs",
                    "offsetStart": "md",
                    "offsetEnd": "xxl",
                    "offsetBottom": "xxl"
                  }
                ]
              },
              {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                  {
                    "type": "text",
                    "text": "ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰è¿½åŠ ",
                    "size": "md",
                    "color": "#000000",
                    "flex": 1,
                    "weight": "bold",
                    "margin": "none",
                    "action": {
                      "type": "message",
                      "label": "è¡¨ç¤º",
                      "text": "ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰è¿½åŠ "
                    }
                  },
                  {
                    "type": "button",
                    "action": {
                      "type": "message",
                      "label": "è¡¨ç¤º",
                      "text": "ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰è¿½åŠ "
                    },
                    "height": "sm",
                    "flex": 0,
                    "margin": "lg",
                    "offsetTop": "xs",
                    "offsetStart": "md",
                    "offsetEnd": "xxl",
                    "offsetBottom": "xxl"
                  }
                ]
              },
              {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                  {
                    "type": "text",
                    "text": "ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰å‰Šé™¤",
                    "size": "md",
                    "color": "#000000",
                    "flex": 1,
                    "weight": "bold",
                    "margin": "none",
                    "action": {
                      "type": "message",
                      "label": "è¡¨ç¤º",
                      "text": "ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰å‰Šé™¤"
                    }
                  },
                  {
                    "type": "button",
                    "action": {
                      "type": "message",
                      "label": "è¡¨ç¤º",
                      "text": "ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰å‰Šé™¤"
                    },
                    "height": "sm",
                    "flex": 0,
                    "margin": "lg",
                    "offsetTop": "xs",
                    "offsetStart": "md",
                    "offsetEnd": "xxl",
                    "offsetBottom": "xxl"
                  }
                ]
              },
              {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                  {
                    "type": "text",
                    "text": "youtubeå‹•ç”»æ¤œç´¢",
                    "size": "md",
                    "color": "#000000",
                    "flex": 1,
                    "weight": "bold",
                    "margin": "none",
                    "action": {
                      "type": "message",
                      "label": "è¡¨ç¤º",
                      "text": "youtubeå‹•ç”»æ¤œç´¢"
                    }
                  },
                  {
                    "type": "button",
                    "action": {
                      "type": "message",
                      "label": "è¡¨ç¤º",
                      "text": "youtubeå‹•ç”»æ¤œç´¢"
                    },
                    "height": "sm",
                    "flex": 0,
                    "margin": "lg",
                    "offsetTop": "xs",
                    "offsetStart": "md",
                    "offsetEnd": "xxl",
                    "offsetBottom": "xxl"
                  }
                ]
              }
            ]
          }
        ]
      },
      "footer": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "text",
            "text": "Â©2024 moyashi bot",
            "flex": 0,
            "size": "sm",
            "align": "center",
            "margin": "xs",
            "weight": "bold"
          }
        ],
        "backgroundColor": "#7FCCE3",
        "flex": 0
      }
    }
  ]
}


def makeQR(text):
    img = qrcode.make(text)
    img.save('./qr.png')

def send_flex_profile(token, gid, sender):
    res = json.loads(get_profile(token,gid,sender))
    json_data = {
            "type": "bubble", 
            "header": {
                "type": "box", 
                "layout": "horizontal", 
                "contents": [
                    {
                        "type": "image", 
                        "url": f"{res['pictureUrl']}", 
                        "align": "center", 
                        "backgroundColor": "#7FCCE3", 
                        "margin": "none"
                    }, 
                    {
                        "type": "text", 
                        "text": f"{res['displayName']}", 
                        "weight": "bold", 
                        "size": "lg", 
                        "margin": "md", 
                        "align": "start"
                    }
                ]
            }, 
            "body": {
                "type": "box", 
                "layout": "vertical", 
                "contents": [
                    {
                        "type": "box", 
                        "layout": "horizontal", 
                        "contents": [
                            {
                                "type": "text", 
                                "text": "ãƒ¬ãƒ™ãƒ«", 
                                "size": "md", 
                                "color": "#008000", 
                                "flex": 2, 
                                "weight": "bold"
                            }, 
                            {
                                "type": "text", 
                                "text": f"{lvdata['lv'][sender]}", 
                                "size": "md", 
                                "color": "#111111", 
                                "align": "end", 
                                "flex": 4, 
                                "weight": "bold"
                            }
                        ]
                    }, 
                    {
                        "type": "box", 
                        "layout": "horizontal", 
                        "contents": [
                            {
                                "type": "text", 
                                "text": "çµŒé¨“å€¤", 
                                "size": "md", 
                                "color": "#008000", 
                                "flex": 2, 
                                "weight": "bold"
                            }, 
                            {
                                "type": "text", 
                                "text": f"{lvdata['xp'][sender]} / 100", 
                                "size": "md", 
                                "color": "#111111", 
                                "align": "end", 
                                "flex": 4, 
                                "weight": "bold"
                            }
                        ]
                    }
                ]
            }, 
            "footer": {
                "type": "box", 
                "layout": "vertical", 
                "contents": [
                    {
                        "type": "text", 
                        "text": "Â©2024 moyashi bot", 
                        "flex": 0, 
                        "size": "sm", 
                        "align": "center", 
                        "margin": "xs", 
                        "weight": "bold"
                    }
                ], 
                "backgroundColor": "#7FCCE3", 
                "flex": 0
            }, 
            "styles": {
                "footer": {
                    "separator": True
                }
            }
        }
    return json_data

def sessionfunc(op,client):
    type = status["session"][op.source.user_id]["type"]
    if type == "greeting":
        NGTF = NgWordSystem.detect(op.message.text)
        if NGTF == False:
            gid = op.source.group_id
            status["gred"][gid] = op.message.text
            client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=f"èª°ã‹ãŒå‚åŠ ã—ãŸã¨ãã«ã€Œ{op.message.text}ã€ã¨é€ä¿¡ã—ã¾ã™")]))
            del status["session"][op.source.user_id]
        else:
            client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™")]))
            del status["session"][op.source.user_id]
    elif type == "leaving":
        gid = op.source.group_id
        status["leav"][gid] = op.message.text
        client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=f"None")]))
        del status["session"][op.source.user_id]
    elif type == "addreact":
        gid = op.source.group_id
        del status["session"][op.source.user_id]
        if not op.message.text in status["group"][gid]:
                client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=f"åå¿œãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸ\nç¶šã„ã¦ãã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚ŒãŸã¨ãã«è¿”ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã£ã¦ãã ã•ã„")]))
        else:
                client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="æ—¢ã«ãã®ãƒ¯ãƒ¼ãƒ‰ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™")]))
        status["session"][op.source.user_id] = {}
        status["session"][op.source.user_id]["type"] = "s_addreact"
        status["session"][op.source.user_id]["description"] = op.message.text
    elif type == "s_addreact":
        gid = op.source.group_id
        NGTF = NgWordSystem.detect(op.message.text)
        if  NGTF == False:
                status["group"][gid][status["session"][op.source.user_id]["description"]] = {"text":op.message.text,"UserId":op.source.user_id}
                client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="åå¿œãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸ")]))
        else:
                client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ã§ã™")]))
        del status["session"][op.source.user_id]
    elif type == "delreact":
        gid = op.source.group_id
        if op.message.text in status["group"][gid]:
            del status["group"][gid][op.message.text]
            client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=f"åå¿œãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ")]))
            del status["session"][op.source.user_id]
        else:
            client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=f"ãã®åå¿œãƒ¯ãƒ¼ãƒ‰ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“")]))
            del status["session"][op.source.user_id]

    elif type == "r_addreact":
        gid = op.source.group_id
        del status["session"][op.source.user_id]
        NGTF = NgWordSystem.detect(op.message.text)
        if not op.message.text in status["group"][gid] and NGTF == False:
                client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=f"ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸ\nç¶šã„ã¦ãã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚ŒãŸã¨ãã«è¿”ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã£ã¦ãã ã•ã„")]))
        else:
                client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="æ—¢ã«ãã®ãƒ¯ãƒ¼ãƒ‰ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™")]))
        status["session"][op.source.user_id] = {}
        status["session"][op.source.user_id]["type"] = "rs_addreact"
        status["session"][op.source.user_id]["description"] = op.message.text
    elif type == "rs_addreact":
        gid = op.source.group_id
        NGTF = NgWordSystem.detect(op.message.text)
        if NGTF == False:
                status["group"][gid][status["session"][op.source.user_id]["description"]] = {"text":op.message.text,"UserId":"RANDOM"}
                client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸ")]))
        else:
                client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ãŒãµãã¾ã‚Œã¦ã„ã¾ã™")]))
        del status["session"][op.source.user_id]
    elif type == "r_delreact":
        gid = op.source.group_id
        if op.message.text in status["group"][gid]:
            del status["group"][gid][op.message.text]
            client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=f"ã‚’ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ")]))
            del status["session"][op.source.user_id]
        else:
            client.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=f"ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰ã«ç™»éŒ²ã•ã‚Œã¦ãªã„ã‹ã€ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ã§ã™")]))
            del status["session"][op.source.user_id]
    elif type == "ytsearch":
            receiveData = youtubeSearch(op.message.text,10)
            client.reply_message_with_http_info(
                ReplyMessageRequest(
                    replyToken=op.reply_token,
                    messages=[
                        FlexMessage(
                            altText="result",
                            contents=FlexContainer.from_dict(receiveData),
                            quickReply=None,
                        )
                    ],
                    notificationDisabled=None,
                )
                )
            del status["session"][op.source.user_id]
    else:
        pass

def load_audio_file(file_path):
    """
    éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
    """
    recognizer = sr.Recognizer()
    with sr.AudioFile(file_path) as source:
        audio_data = recognizer.record(source)
    return audio_data

def transcribe_audio(audio_data):
    """
    éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã™ã‚‹é–¢æ•°
    """
    recognizer = sr.Recognizer()
    try:
        text = recognizer.recognize_google(audio_data, language='ja-JP')
    except sr.UnknownValueError:
        return "éŸ³å£°ã‚’èªè­˜ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚"
    except sr.RequestError:
        return "APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚"
    return text

@app.route('/')
def index():
    return 'Hallow Warld!'

@app.route("/callback", methods=['POST'])
def callback():
    signature = request.headers['X-Line-Signature']
    body = request.get_data(as_text=True)
    app.logger.info("Request body: " + body)
    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        app.logger.info("Invalid signature. Please check your channel access token/channel secret.")
        abort(400)

    return 'OK'




@handler.add(MessageEvent, message=TextMessageContent)
def handle_message(op: MessageEvent) -> None:
    with ApiClient(configuration) as api_client:
         chatType = op.source.type #group == group
         try:
             gid = op.source.group_id
         except:
             gid = "None"
         sender = op.source.user_id
         msgtype = op.message.type
         msgid = op.message.id
         text = op.message.text 
         mentionees = op.message.mention
         if not gid in groupmember:
             groupmember[gid] = []
         else:
             pass
         if not sender in groupmember[gid]:
             groupmember[gid].append(sender)
         if not gid in msgdata:
            msgdata[gid] = {}
            msgdata[gid][msgid] = text
         else:
            msgdata[gid][msgid] = text
         if not gid in lvdata["group"]:
            lvdata["group"][gid] = []
         if not sender in lvdata["group"][gid]:
            lvdata["group"][gid].append(sender)
         if not gid in status["group"]:
             status["group"][gid] = {}
         line_bot_api = MessagingApi(api_client)
         if sender in status["session"]:
            sessionfunc(op,line_bot_api)
         if text == "åå¿œãƒ¯ãƒ¼ãƒ‰å…¨å‰Šé™¤":
            if sender in status["admin"]:
                status["group"][gid] = {}
                line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="success")]))
         if text == "ã‚»ãƒƒã‚·ãƒ§ãƒ³å…¨å‰Šé™¤":
            if sender in status["admin"]:
                status["session"] = {}
                line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="success")]))
         if text == "getdata:on":
            if sender in status["admin"]:
                try:
                    status["getdata"].append(gid)
                except:
                    status["getdata"] = []
                    status["getdata"].append(gid)
                line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ok")]))
         if text == "getdata:off":
            if sender in status["admin"]:
                try:
                    status["getdata"].remove(gid)
                except:
                    status["getdata"] = []
                    status["getdata"].remove(gid)
                line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ok")]))
         if text == "view":
            if sender in status["admin"]:
                lis = "ä¿å­˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆ"
                files = glob.glob(f"./datas/{gid}/*")
                for file in files:
                    file = file.replace(f"./datas/{gid}/","")
                    lis += f"\nãƒ»{file}"
                lis += f"\nåˆè¨ˆ{len(files)}å€‹ã®ç”»åƒã‚„å‹•ç”»"
                line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=lis)]))
         if text == "é€€ä¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç™»éŒ²":
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ã“ã®æ©Ÿèƒ½ãƒŸã‚¹ã£ã¦ã¤ã‘ãŸã ã‘ã§ã™")]))
            #line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="é€€ä¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è¨­å®šã—ãŸã„ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¦ãã ã•ã„")]))
            #status["session"][sender] = {}
            #status["session"][sender]["type"] = "leaving"
         if text == "å‚åŠ æŒ¨æ‹¶ç™»éŒ²":
            #line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ã“ã®æ©Ÿèƒ½ã¯ç¾åœ¨ã“ã®æ©Ÿèƒ½ã¯ã”åˆ©ç”¨ã„ãŸã ãã“ã¨ãŒã§ãã¾ã›ã‚“")]))
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="å‚åŠ æŒ¨æ‹¶ã«è¨­å®šã—ãŸã„ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¦ãã ã•ã„")]))
            status["session"][sender] = {}
            status["session"][sender]["type"] = "greeting"
         if text == "åå¿œãƒ¯ãƒ¼ãƒ‰è¿½åŠ ":
            #line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ç¾åœ¨ã“ã®æ©Ÿèƒ½ã¯ã”åˆ©ç”¨ã„ãŸã ãã“ã¨ãŒã§ãã¾ã›ã‚“")]))
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="åå¿œãƒ¯ãƒ¼ãƒ‰ã«è¨­å®šã—ãŸã„ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¦ãã ã•ã„")]))
            status["session"][sender] = {}
            status["session"][sender]["type"] = "addreact"
         if text == "åå¿œãƒ¯ãƒ¼ãƒ‰å‰Šé™¤":
            #line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ç¾åœ¨ã“ã®æ©Ÿèƒ½ã¯ã”åˆ©ç”¨ã„ãŸã ãã“ã¨ãŒã§ãã¾ã›ã‚“")]))
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="åå¿œãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰å‰Šé™¤ã—ãŸã„ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¦ãã ã•ã„")]))
            status["session"][sender] = {}
            status["session"][sender]["type"] = "delreact"
         if text == "ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰è¿½åŠ ":
            #line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ç¾åœ¨ã“ã®æ©Ÿèƒ½ã¯ã”åˆ©ç”¨ã„ãŸã ãã“ã¨ãŒã§ãã¾ã›ã‚“")]))
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰ã«è¨­å®šã—ãŸã„ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¦ãã ã•ã„")]))
            status["session"][sender] = {}
            status["session"][sender]["type"] = "r_addreact"
         if text == "ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰å‰Šé™¤":
            #line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ç¾åœ¨ã“ã®æ©Ÿèƒ½ã¯ã”åˆ©ç”¨ã„ãŸã ãã“ã¨ãŒã§ãã¾ã›ã‚“")]))
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ãƒ©ãƒ³ãƒ€ãƒ åå¿œãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰å‰Šé™¤ã—ãŸã„ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¦ãã ã•ã„")]))
            status["session"][sender] = {}
            status["session"][sender]["type"] = "r_delreact"
         if text == "youtubeå‹•ç”»æ¤œç´¢":
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’é€ã£ã¦ãã ã•ã„")]))
            status["session"][sender] = {}
            status["session"][sender]["type"] = "ytsearch"
         if text == "ãƒ†ã‚¹ãƒˆ" or text == "ã¦ã™ã¨" or text == "test":
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ã†ã”ã„ã¦ã‚‹ã‚ˆ")]))
         if text == "ãƒ˜ãƒ«ãƒ—" or text == "ã¸ã‚‹ã·" or text == "help":
            line_bot_api.reply_message_with_http_info(
            ReplyMessageRequest(
                replyToken=op.reply_token,
                messages=[
                    FlexMessage(
                        altText="ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
                        contents=FlexContainer.from_dict(flex_helpmessage),
                        quickReply=None,
                    )
                ],
                notificationDisabled=None,
            )
            )
         if text == "rank" or text == "ãƒ©ãƒ³ã‚­ãƒ³ã‚°" or text == "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«" or text == "ãƒ—ãƒ­ãƒ•" or text == "ã‚‰ã‚“ã" or text == "ã‚‰ã‚“ãã‚“ã" or text == "ã·ã‚ãµ" or text == "ã·ã‚ãµãƒãƒ¼ã‚‹" or text == "ã™ã¦ãƒ¼ãŸã™" or text == "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹" or text == "status" or text == "Status" or text == "Rank":
            p = json.loads(get_profile(token,gid,sender))['displayName']
            jsondata = send_flex_profile(token,gid,sender)
            res = line_bot_api.reply_message_with_http_info(
            ReplyMessageRequest(
                replyToken=op.reply_token,
                messages=[
                    FlexMessage(
                        altText=f"ãƒ©ãƒ³ã‚­ãƒ³ã‚°",
                        contents=FlexContainer.from_dict(jsondata),
                        quickReply=None,
                    )
                ],
                notificationDisabled=None,
            )
            )
         if text == "gid":
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=gid)]))
         if text == "uid":
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=sender)]))
         if text == "åå¿œãƒ¯ãƒ¼ãƒ‰ä¸€è¦§" or text == "åå¿œãƒ¯ãƒ¼ãƒ‰" or text == "ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§":
            re = "åå¿œãƒ¯ãƒ¼ãƒ‰ä¸€è¦§\n"
            f = 0
            if not status["group"][gid] == {}:
                for a in status["group"][gid]:
                    if f == 0:
                        if status['group'][gid][a]['UserId'] == "RANDOM":
                            re = re + f"\nåå¿œ: {a}"
                            re = re + f"\nè¿”ç­”: {status['group'][gid][a]['text']} * RANDOM\n"
                        else:
                            re = re + f"\nåå¿œ: {a}"
                            re = re + f"\nè¿”ç­”: {status['group'][gid][a]['text']}\n"
                    else:
                        if status['group'][gid][a]['UserId'] == "RANDOM":
                            re = re + f"-----------------\nåå¿œ: {a}"
                            re = re + f"\nè¿”ç­”: {status['group'][gid][a]['text']} * RANDOM"
                        else:
                            re = re + f"-----------------\nåå¿œ: {a}"
                            re = re + f"\nè¿”ç­”: {status['group'][gid][a]['text']}"
                line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=re)]))
            else:
                line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text="ãƒ¯ãƒ¼ãƒ‰ãŒä¸€ã¤ã‚‚ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“")]))
         elif text == 'checkcredit':
            if not sender in slot:
                slot[sender] = {}
                slot[sender]["credit"] = 50
            else:
                pass
            line_bot_api.reply_message_with_http_info(ReplyMessageRequest(reply_token=op.reply_token,messages=[TextMessage(text=f"ç¾åœ¨ã®ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ:{slot[sender]['credit']}")]))
         elif text == 'ã‚¹ãƒ­ãƒƒãƒˆ':
            line_bot_api.reply_message(
                ReplyMessageRequest(
                    reply_token=op.reply_token,
                    messages=[TextMessage(
                        text='é–‹å§‹ã—ã¾ã™ã‹',
                        quick_reply=QuickReply(
                            items=[
                                QuickReplyItem(
                                    action=MessageAction(label="é–‹å§‹ã™ã‚‹", text="start:slot")
                                ),
                                QuickReplyItem(
                                    action=PostbackAction(label="ã‚„ã‚‰ãªã„", data="skip")
                                )
                            ]
                        )
                    )]
                )
            )
         elif text == "ã‚ªã‚»ãƒ­":
            init = create_othello_board()
            flex = create_playable_othello_flex_message(init)
            line_bot_api.reply_message_with_http_info(
            ReplyMessageRequest(
                replyToken=op.reply_token,
                messages=[
                    FlexMessage(
                        altText="ã‚ªã‚»ãƒ­",
                        contents=FlexContainer.from_dict(flex),
                        quickReply=None,
                    )
                ],
                notificationDisabled=None,
            )
            )
         elif text == 'ã‚¹ãƒ­ãƒƒãƒˆhelp':
            buttons_template = ButtonsTemplate(
                title='ã‚¹ãƒ­ãƒƒãƒˆã‚²ãƒ¼ãƒ ',
                text='Beta',
                actions=[
                    MessageAction(label='ã‚¹ãƒ­ãƒƒãƒˆã‚’å›ã™', text='ã‚¹ãƒ­ãƒƒãƒˆ'),
                    MessageAction(label='ã‚¹ãƒ­ãƒƒãƒˆã®æ®‹ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆæ•°ã‚’ç¢ºèªã™ã‚‹', text='checkcredit')
                ])
            template_message = TemplateMessage(
                alt_text='ã‚¹ãƒ­ãƒƒãƒˆã‚²ãƒ¼ãƒ ',
                template=buttons_template
            )
            line_bot_api.reply_message(
                ReplyMessageRequest(
                    reply_token=op.reply_token,
                    messages=[template_message]
                )
            )
         elif text == "start:slot":
            if sender in slot:
                result = slotgame(sender)
                line_bot_api.reply_message(
                ReplyMessageRequest(
                    reply_token=op.reply_token,
                    messages=[TextMessage(
                        text=f'çµæœ: {result}\nç¾åœ¨ã®ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ: {slot[sender]["credit"]}',
                        quick_reply=QuickReply(
                            items=[
                                QuickReplyItem(
                                    action=MessageAction(label="ã‚‚ã†ä¸€åº¦å¼•ã", text="start:slot")
                                ),
                                QuickReplyItem(
                                    action=PostbackAction(label="ã‚‚ã†ã‚„ã‚ã¨ã", data="skip")
                                )
                            ]
                        )
                    )]
                )
            )
            elif not sender in slot:
                slot[sender] = {}
                slot[sender]["credit"] = 50
                slot[sender]["BB"] = False
                result = slotgame(sender,slot[sender]["BB"])
                line_bot_api.reply_message(
                ReplyMessageRequest(
                    reply_token=op.reply_token,
                    messages=[TextMessage(
                        text=f'çµæœ: {result}\nç¾åœ¨ã®ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ: {slot[sender]["credit"]}',
                        quick_reply=QuickReply(
                            items=[
                                QuickReplyItem(
                                    action=MessageAction(label="ã‚‚ã†ä¸€åº¦å¼•ã", text="start:slot")
                                ),
                                QuickReplyItem(
                                    action=PostbackAction(label="ã‚‚ã†ã‚„ã‚ã¨ã", data="skip")
                                )
                            ]
                        )
                    )]
                )
            )
            else:
                pass
         elif text == 'leave':
            if isinstance(op.source, GroupSource):
                line_bot_api.reply_message(
                    ReplyMessageRequest(
                        reply_token=op.reply_token,
                        messages=[TextMessage(text="ã°ã„ã°ã„ï¼")]
                    )
                )
                line_bot_api.leave_group(op.source.group_id)
            elif isinstance(op.source, RoomSource):
                line_bot_api.reply_message(
                    ReplyMessageRequest(
                        reply_token=op.reply_token,
                        messages=[TextMessage(text="ã°ã„ã°ã„ï¼")]
                    )
                )
                line_bot_api.leave_room(room_id=op.source.room_id)
            else:
                line_bot_api.reply_message(
                    ReplyMessageRequest(
                        reply_token=op.reply_token,
                        messages=[
                            TextMessage(text="å€‹äººãƒˆãƒ¼ã‚¯ã˜ã‚ƒé€€ä¼šã§ããªã„ã‚ˆï¼")
                        ]
                    )
                )
         elif text == "unsend":
            #line_bot_api.reply_message(
            #        ReplyMessageRequest(
            #            reply_token=op.reply_token,
            #            messages=[
            #                TextMessage(text="ç¾åœ¨ã“ã®æ©Ÿèƒ½ã¯ã”åˆ©ç”¨ã„ãŸã ãã“ã¨ãŒã§ãã¾ã›ã‚“")
            #            ]
            #        )
            #)
            if gid in unsend:
                rct = len(unsend[gid]["msgid"])
                ct = 0
                tt = "é€ä¿¡å–ã‚Šæ¶ˆã—ãƒ­ã‚°\n"
                for a in range(rct):
                    prof = json.loads(get_profile(token,gid,UserId))
                    NGTF = NgWordSystem.detect(msgdata[gid][unsend[gid]["msgid"][ct]])
                    NGTF_display = NgWordSystem.detect(prof['displayName'])
                    if NGTF is False and NGTF_display is False:
                        UserId = unsend[gid]["userid"][ct]
                        text = msgdata[gid][unsend[gid]["msgid"][ct]]
                        prof = json.loads(get_profile(token,gid,UserId))
                        displayName = prof['displayName']
                        tt += f"\n[{displayName}] {text}"
                        ct += 1
                line_bot_api.reply_message(
                    ReplyMessageRequest(
                        reply_token=op.reply_token,
                        messages=[
                            TextMessage(text=tt)
                        ]
                    )
                )
            else:
                line_bot_api.reply_message(
                    ReplyMessageRequest(
                        reply_token=op.reply_token,
                        messages=[
                            TextMessage(text="é€ä¿¡å–ã‚Šæ¶ˆã—ã•ã‚Œã¦ã¾ã›ã‚“")
                        ]
                    )
                )
         elif text == "å‚åŠ æŒ¨æ‹¶åˆ‡ã‚Šæ›¿ãˆ":
            if gid in status["greeting"]:
                status["greeting"].remove(gid)
                line_bot_api.reply_message(
                    ReplyMessageRequest(
                        reply_token=op.reply_token,
                        messages=[
                            TextMessage(text="å‚åŠ æŒ¨æ‹¶ã—ãªã„ã‚ˆã†ã«è¨­å®šã—ã¾ã—ãŸ")
                        ]
                    )
                )
            elif not gid in status["greeting"]:
                status["greeting"].append(gid)
                if not gid in status["gred"]:
                    status["gred"][gid] = "ã‚ˆã‚ã—ãï¼"
                line_bot_api.reply_message(
                    ReplyMessageRequest(
                        reply_token=op.reply_token,
                        messages=[
                            TextMessage(text="å‚åŠ æŒ¨æ‹¶ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã—ãŸ")
                        ]
                    )
                )
            else:
                pass

         elif text == "ãŠã¿ãã˜":
            resp = json.loads(get_profile(token,gid,sender))['displayName']
            fortunes = ["å¤§å‰", "ä¸­å‰", "å°å‰", "å‰", "å‡¶", "å¤§å‡¶"]
            selected_fortune = random.choice(fortunes)
            line_bot_api.reply_message(
                ReplyMessageRequest(
                    reply_token=op.reply_token,
                    messages=[
                        TextMessage(text=f"é‹å‹¢ã¯\n{selected_fortune}ã§ã™")
                    ]
                )
            )
         elif text == 'å‚åŠ æŒ¨æ‹¶è¨­å®š':
            if gid in status["greeting"]:
                fd="ã‚ªãƒ³"
            else:
                fd="ã‚ªãƒ•"
            buttons_template = ButtonsTemplate(
                title='å‚åŠ æŒ¨æ‹¶è¨­å®š',
                text=f'ç¾åœ¨å‚åŠ æŒ¨æ‹¶ã¯{fd}ã«ãªã£ã¦ã„ã¾ã™',
                actions=[
                    MessageAction(label='å‚åŠ æŒ¨æ‹¶ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç™»éŒ²ã™ã‚‹', text='å‚åŠ æŒ¨æ‹¶ç™»éŒ²'),
                    MessageAction(label='å‚åŠ æŒ¨æ‹¶ã‚’ã‚ªãƒ³ã€ã¾ãŸã¯ã‚ªãƒ•ã«ã™ã‚‹', text='å‚åŠ æŒ¨æ‹¶åˆ‡ã‚Šæ›¿ãˆ')
                ])
            template_message = TemplateMessage(
                alt_text='å‚åŠ æŒ¨æ‹¶è¨­å®š',
                template=buttons_template
            )
            line_bot_api.reply_message(
                ReplyMessageRequest(
                    reply_token=op.reply_token,
                    messages=[template_message]
                )
            )
         if text in status["group"][gid]:
            if status["group"][gid][text]["UserId"] == "RANDOM":
                res = json.loads(get_profile(token,gid,random.choice(groupmember[gid])))
                line_bot_api.reply_message_with_http_info(
                ReplyMessageRequest(
                    replyToken=op.reply_token,
                    messages=[
                        TextMessage(
                            text=status["group"][gid][text]["text"],
                            sender={
                                "name":res["displayName"],
                                "iconUrl":res["pictureUrl"]
                            }
                        )
                    ],
                    notificationDisabled=None,
                )
                )
            else:
                res = json.loads(get_profile(token,gid,status["group"][gid][text]["UserId"]))
                line_bot_api.reply_message_with_http_info(
                ReplyMessageRequest(
                    replyToken=op.reply_token,
                    messages=[
                        TextMessage(
                            text=status["group"][gid][text]["text"],
                            sender={
                                "name":res["displayName"],
                                "iconUrl":res["pictureUrl"]
                            }
                        )
                    ],
                    notificationDisabled=None,
                )
                )
         else:
            if not sender in lvdata["lv"]:
                lvdata["lv"][sender] = 1
            if not sender in lvdata["xp"]:
                lvdata["xp"][sender] = 0
            else:
                if lvdata["xp"][sender] == 100:
                    lvdata["xp"][sender] = 0
                    lvdata["lv"][sender] = lvdata["lv"][sender] + 1
                else:
                    lvdata["xp"][sender] = lvdata["xp"][sender] + 1

@handler.add(MemberJoinedEvent)
def handle_member_joined(event):
    if event.source.group_id in status["greeting"]:
        with ApiClient(configuration) as api_client:
            line_bot_api = MessagingApi(api_client)
            line_bot_api.reply_message(
                ReplyMessageRequest(
                    reply_token=event.reply_token,
                    messages=[TextMessage(text=status["gred"][event.source.group_id])]
                )
            )

@handler.add(PostbackEvent)
def handle_postback(event: PostbackEvent):
    with ApiClient(configuration) as api_client:
        line_bot_api = MessagingApi(api_client)
        if event.postback.data == 'skip':
            pass

@handler.add(JoinEvent)
def handle_join(event):
    with ApiClient(configuration) as api_client:
        line_bot_api = MessagingApi(api_client)
        line_bot_api.reply_message(
            ReplyMessageRequest(
                reply_token=event.reply_token,
                messages=[TextMessage(text=f"ã‚‚ã‚„ã—botã§ã™\nhelp ã§ä½¿ã„æ–¹ãŒç¢ºèªã§ãã¾ã™\nä½œè€…ã®Twitter: https://x.com/shota5561\nã‚µãƒãƒ¼ãƒˆOC: https://line.me/ti/g2/sAcQUnPUoED4n9pEYZRXXcOZD6ivox9pk7Zcfg")]
            )
        )

@handler.add(FollowEvent)
def handle_follow(event):
    with ApiClient(configuration) as api_client:
        line_bot_api = MessagingApi(api_client)
        line_bot_api.reply_message(
            ReplyMessageRequest(
                reply_token=event.reply_token,
                messages=[TextMessage(text='ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ï¼')]
            )
        )
@handler.add(UnsendEvent)
def handle_unsend(event):
    type = event.source.type
    gid = event.source.group_id
    userid = event.source.user_id
    msgid = event.unsend.message_id
    if type in ["group","room"]:
        if not gid in unsend:
            unsend[gid] = {}
            unsend[gid]["msgid"] = []
            unsend[gid]["userid"] = []
        else:
            pass
        if 15 == len(unsend[gid]["msgid"]):
            unsend[gid]["msgid"].remove(unsend[gid]["msgid"][0]) #å¤ã„é †ã‹ã‚‰æ¶ˆã™
            unsend[gid]["msgid"].append(msgid)
            unsend[gid]["userid"].append(userid)
        else:
            unsend[gid]["msgid"].append(msgid)
            unsend[gid]["userid"].append(userid)

@handler.add(MemberLeftEvent)
def handle_member_left(event):
    groupmember[event.source.group_id].append(event.source.user_id)

@handler.add(MessageEvent, message=(ImageMessageContent,
                                    VideoMessageContent,
                                    AudioMessageContent))
def handle_content_message(event):
    if isinstance(event.message, ImageMessageContent):
        ext = 'jpg'
    elif isinstance(event.message, VideoMessageContent):
        ext = 'mp4'
    elif isinstance(event.message, AudioMessageContent):
        ext = 'm4a'
    else:
        return
    if not ext == "m4a":
      if event.source.group_id in status["getdata"]:
        with ApiClient(configuration) as api_client:
            line_bot_blob_api = MessagingApiBlob(api_client)
            message_content = line_bot_blob_api.get_message_content(message_id=event.message.id)
            try:
                with tempfile.NamedTemporaryFile(dir=f"./datas/{event.source.group_id}/", prefix=ext + '-', delete=False) as tf:
                    tf.write(message_content)
                    tempfile_path = tf.name
            except:
                new_dir_path = f'datas/{event.source.group_id}'
                os.mkdir(new_dir_path)
                with tempfile.NamedTemporaryFile(dir=f"./datas/{event.source.group_id}/", prefix=ext + '-', delete=False) as tf:
                    tf.write(message_content)
                    tempfile_path = tf.name
        dist_path = tempfile_path + '.' + ext
        os.rename(tempfile_path, dist_path)
        pass
    elif ext == "m4a":
        with ApiClient(configuration) as api_client:
            line_bot_blob_api = MessagingApiBlob(api_client)
            message_content = line_bot_blob_api.get_message_content(message_id=event.message.id)
            try:
                with tempfile.NamedTemporaryFile(dir=f"./audio/", delete=False) as tf:
                    tf.write(message_content)
                    tempfile_path = tf.name
            except:
                new_dir_path = f'datas/{event.source.group_id}'
                os.mkdir(new_dir_path)
                with tempfile.NamedTemporaryFile(dir=f"./audio/", delete=False) as tf:
                    tf.write(message_content)
                    tempfile_path = tf.name
        dist_path = "audio_data" + '.' + ext
        os.rename(tempfile_path, dist_path)
        stream = ffmpeg.input("audio_data.m4a")
        stream = ffmpeg.output(stream, "result.wav")
        ffmpeg.run(stream,quiet=True)
        directory_path = "./result.wav"
        audio_data = load_audio_file(directory_path)
        text = transcribe_audio(audio_data)
        for a in NG:
            text = text.replace(a,"***")
        text = text.replace("é»’æ²¢","ãã‚ã•ã‚") #èº«å†…ç”¨
        text = text.replace("é»’æ¾¤","ãã‚ã•ã‚") #èº«å†…ç”¨
        with ApiClient(configuration) as api_client:
            line_bot_api = MessagingApi(api_client)
            line_bot_api.reply_message(
            ReplyMessageRequest(
                    reply_token=event.reply_token,
                    messages=[
                        TextMessage(text=f'<éŸ³å£°èªè­˜>\n{text}')
                    ]
                )
            )
        os.remove('./result.wav')
    else:
        pass


@handler.add(MessageEvent, message=FileMessageContent)
def handle_file_message(event):
    with ApiClient(configuration) as api_client:
        line_bot_blob_api = MessagingApiBlob(api_client)
        message_content = line_bot_blob_api.get_message_content(message_id=event.message.id)
        try:
            with tempfile.NamedTemporaryFile(dir=f"./files/{event.source.group_id}/", prefix='file-', delete=False) as tf:
                tf.write(message_content)
                tempfile_path = tf.name
        except:
            new_dir_path = f'files/{event.source.group_id}'
            os.mkdir(new_dir_path)
            with tempfile.NamedTemporaryFile(dir=f"./files/{event.source.group_id}/", prefix='file-', delete=False) as tf:
                tf.write(message_content)
                tempfile_path = tf.name

    dist_path = tempfile_path + '-' + event.message.file_name
    os.rename(tempfile_path, dist_path)

@handler.add(UnknownEvent)
def handle_unknown_left(event):
    print(event)

@handler.add(UnfollowEvent)
def handle_unfollow(event):
    print(event)



app.run(port=5000)
